<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Power Analysis for Time-Course Phosphoproteomics (DDA) • peppwR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Power Analysis for Time-Course Phosphoproteomics (DDA)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">peppwR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/find-fits.html">Distribution Fitting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>In-depth Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/power-analysis-workflow.html">Power Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking.html">Benchmarking</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Real-World Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/dda-time-course-power.html">DDA Time Course Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/prm-genotype-power.html">PRM Genotype Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/TeamMacLean/peppwR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Power Analysis for Time-Course Phosphoproteomics (DDA)</h1>
                        <h4 data-toc-skip class="author">peppwR</h4>
            
            <h4 data-toc-skip class="date">2026-02-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/TeamMacLean/peppwR/blob/master/vignettes/articles/dda-time-course-power.Rmd" class="external-link"><code>vignettes/articles/dda-time-course-power.Rmd</code></a></small>
      <div class="d-none name"><code>dda-time-course-power.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="what-is-statistical-power">What is Statistical Power?<a class="anchor" aria-label="anchor" href="#what-is-statistical-power"></a>
</h3>
<p>Statistical power is the probability of detecting a true effect when
one exists. In proteomics experiments, this translates to: “If a
phosphopeptide truly changes between conditions, how likely are we to
find it statistically significant?”</p>
<p>Power depends on four interconnected factors:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Effect size</strong> - How large is the biological change?
(e.g., 2-fold)</li>
<li>
<strong>Sample size</strong> - How many biological replicates per
group?</li>
<li>
<strong>Variability</strong> - How noisy is the measurement?</li>
<li>
<strong>Significance threshold</strong> - What alpha level are we
using? (typically 0.05)</li>
</ol>
</div>
<div class="section level3">
<h3 id="why-does-power-matter">Why Does Power Matter?<a class="anchor" aria-label="anchor" href="#why-does-power-matter"></a>
</h3>
<p>Phosphoproteomics experiments are expensive and time-consuming.
Under-powered experiments waste resources by failing to detect real
biological changes. Over-powered experiments waste resources by using
more samples than necessary.</p>
<p>Power analysis helps researchers:</p>
<ul>
<li>
<strong>Before an experiment:</strong> Determine required sample
size for adequate power</li>
<li>
<strong>After a pilot:</strong> Assess what effects can be detected
with current data</li>
<li>
<strong>For grant planning:</strong> Justify sample size
requirements to reviewers</li>
</ul>
</div>
<div class="section level3">
<h3 id="the-peppwr-approach">The peppwR Approach<a class="anchor" aria-label="anchor" href="#the-peppwr-approach"></a>
</h3>
<p>peppwR uses simulation-based power analysis:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Fit distributions</strong> to pilot data to capture
realistic abundance patterns</li>
<li>
<strong>Simulate experiments</strong> by drawing from fitted
distributions</li>
<li>
<strong>Apply statistical tests</strong> to simulated data</li>
<li>
<strong>Estimate power</strong> as the proportion of simulations
with significant results</li>
</ol>
<p>This approach captures the full complexity of phosphoproteomics data,
including heterogeneity across peptides.</p>
</div>
</div>
<div class="section level2">
<h2 id="about-the-data">About the Data<a class="anchor" aria-label="anchor" href="#about-the-data"></a>
</h2>
<p>This analysis uses Arabidopsis phosphoproteomics data from a
time-course experiment:</p>
<table class="table">
<thead><tr class="header">
<th>Property</th>
<th>Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Method</td>
<td>DDA (Data-Dependent Acquisition) mass spectrometry</td>
</tr>
<tr class="even">
<td>Comparison</td>
<td>Early (t=0) vs late (t=600) timepoints</td>
</tr>
<tr class="odd">
<td>Biological replicates</td>
<td>3 per condition</td>
</tr>
<tr class="even">
<td>Total observations per peptide</td>
<td>6 (important limitation!)</td>
</tr>
<tr class="odd">
<td>Peptides</td>
<td>2,228 phosphopeptides quantified</td>
</tr>
<tr class="even">
<td>Missing data</td>
<td>None (complete observations)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://teammaclean.github.io/peppwR/">peppwR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the DDA experiment data</span></span>
<span><span class="va">dda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"../../sample_data/dda_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Examine the structure</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">dda</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 26,820</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ protein_name      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PROT_0001"<span style="color: #949494;">, </span>"PROT_0001"<span style="color: #949494;">, </span>"PROT_0001"<span style="color: #949494;">, </span>"PROT_0001"<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">## $ genotype          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Genotype_A"<span style="color: #949494;">, </span>"Genotype_A"<span style="color: #949494;">, </span>"Genotype_A"<span style="color: #949494;">, </span>"Genotype_…</span></span>
<span><span class="co">## $ bio_rep           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3…</span></span>
<span><span class="co">## $ tech_rep          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0…</span></span>
<span><span class="co">## $ timepoints        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>150<span style="color: #949494;">, </span>150<span style="color: #949494;">, </span>150<span style="color: #949494;">, </span>300<span style="color: #949494;">, </span>300<span style="color: #949494;">, </span>300<span style="color: #949494;">, </span>600<span style="color: #949494;">, </span>600<span style="color: #949494;">, </span>600…</span></span>
<span><span class="co">## $ timepoints_values <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 111486.89<span style="color: #949494;">, </span>169993.66<span style="color: #949494;">, </span>7241966.48<span style="color: #949494;">, </span>174394.39<span style="color: #949494;">, </span>2955899…</span></span>
<span><span class="co">## $ new_annotation    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PEP_00001"<span style="color: #949494;">, </span>"PEP_00001"<span style="color: #949494;">, </span>"PEP_00001"<span style="color: #949494;">, </span>"PEP_00001"<span style="color: #949494;">, </span>…</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to early (0) vs late (600) timepoints and format for peppwR</span></span>
<span><span class="va">pilot</span> <span class="op">&lt;-</span> <span class="va">dda</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">timepoints</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>    peptide_id <span class="op">=</span> <span class="va">new_annotation</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">timepoints</span><span class="op">)</span>,</span>
<span>    abundance <span class="op">=</span> <span class="va">timepoints_values</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Unique peptides:"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">pilot</span><span class="op">$</span><span class="va">peptide_id</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unique peptides: 2228</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Observations per condition:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Observations per condition:</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pilot</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   condition    n</span></span>
<span><span class="co">## 1        t0 6705</span></span>
<span><span class="co">## 2      t600 6705</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Exploratory visualization</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pilot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Log2 Abundance"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Phosphopeptide Abundance Distribution"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/eda-plot-1.png" class="r-plt" alt="Distribution of log2 abundance values across conditions. The broad range and right-skew are typical for phosphoproteomics data." width="768"><p class="caption">
Distribution of log2 abundance values across conditions. The broad range
and right-skew are typical for phosphoproteomics data.
</p>
</div>
<p>The abundance values span several orders of magnitude, typical for
phosphoproteomics data. The distributions appear similar between
timepoints at the global level, though individual peptides may show
significant changes.</p>
</div>
<div class="section level2">
<h2 id="distribution-fitting">Distribution Fitting<a class="anchor" aria-label="anchor" href="#distribution-fitting"></a>
</h2>
<div class="section level3">
<h3 id="why-fit-distributions">Why Fit Distributions?<a class="anchor" aria-label="anchor" href="#why-fit-distributions"></a>
</h3>
<p>To simulate realistic experiments, we need parametric models that
capture the statistical properties of each peptide’s abundance values.
peppwR fits multiple candidate distributions (gamma, lognormal, inverse
Gaussian, Pareto, skew normal, etc.) and selects the best fit for each
peptide based on AIC.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit distributions to each peptide</span></span>
<span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">pilot</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary of fitting results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## peppwr_fits object</span></span>
<span><span class="co">## ------------------</span></span>
<span><span class="co">## 4456 peptides fitted</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Best fit distribution counts:</span></span>
<span><span class="co">##   Gamma: 416</span></span>
<span><span class="co">##   Inverse Gaussian: 1</span></span>
<span><span class="co">##   Loggamma: 1</span></span>
<span><span class="co">##   Normal: 515</span></span>
<span><span class="co">##   Pareto: 3522</span></span>
<span><span class="co">##   Skew Normal: 1</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize which distributions fit best</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/plot-fits-1.png" class="r-plt" alt="Best-fit distribution counts across the peptidome." width="768"><p class="caption">
Best-fit distribution counts across the peptidome.
</p>
</div>
</div>
<div class="section level3">
<h3 id="interpreting-distribution-fitting-results-a-cautionary-note">Interpreting Distribution Fitting Results: A Cautionary Note<a class="anchor" aria-label="anchor" href="#interpreting-distribution-fitting-results-a-cautionary-note"></a>
</h3>
<p><strong>Important:</strong> With only 6 observations per peptide (3
replicates x 2 conditions), distribution selection is unreliable. You
may observe that distributions like Pareto or Skew Normal dominate the
“best fit” counts. This is an <strong>artifact of small sample
size</strong>, not a statement about the true underlying
distributions.</p>
<p>With more biological replicates, we would expect gamma and lognormal
distributions to fit better - these are the typical distributions for
mass spectrometry abundance data based on the underlying measurement
process.</p>
<p><strong>Key insight:</strong> The specific distribution matters less
than having enough data to fit it reliably. For power analysis, we
proceed with the best available fits while acknowledging this
limitation.</p>
</div>
<div class="section level3">
<h3 id="parameter-distribution">Parameter Distribution<a class="anchor" aria-label="anchor" href="#parameter-distribution"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_param_distribution.html">plot_param_distribution</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/param-dist-1.png" class="r-plt" alt="Distribution of AIC values across peptides for each fitted distribution. Lower AIC indicates better fit." width="768"><p class="caption">
Distribution of AIC values across peptides for each fitted distribution.
Lower AIC indicates better fit.
</p>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count peptides per best-fit distribution for context</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nPeptides per best-fit distribution:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Peptides per best-fit distribution:</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>distribution <span class="op">=</span> <span class="va">fits</span><span class="op">$</span><span class="va">best</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   distribution         n</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Pareto            <span style="text-decoration: underline;">3</span>522</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Normal             515</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Gamma              416</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Inverse Gaussian     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Loggamma             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Skew Normal          1</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="power-analysis">Power Analysis<a class="anchor" aria-label="anchor" href="#power-analysis"></a>
</h2>
<div class="section level3">
<h3 id="choosing-the-right-statistical-test">Choosing the Right Statistical Test<a class="anchor" aria-label="anchor" href="#choosing-the-right-statistical-test"></a>
</h3>
<p><strong>Critical first step:</strong> With small samples (N=3), the
choice of statistical test dramatically affects power. Before proceeding
with detailed analysis, we must compare tests to understand their
behavior.</p>
<p>peppwR supports several tests:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th>Test</th>
<th>Type</th>
<th>Characteristics</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Wilcoxon rank-sum</td>
<td>Non-parametric</td>
<td>Conservative, robust to outliers, needs larger N</td>
</tr>
<tr class="even">
<td>Bootstrap-t</td>
<td>Resampling</td>
<td>Handles non-normality through resampling</td>
</tr>
<tr class="odd">
<td>Bayes factor</td>
<td>Bayesian</td>
<td>Evidence-based, often more powerful at small N</td>
</tr>
</tbody>
</table>
<p>Let’s compare all three tests at N=3 with a 2-fold effect:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run all three tests (use n_sim = 100 for faster rendering)</span></span>
<span><span class="va">power_wilcox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"wilcoxon"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">power_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                              find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"bootstrap_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">power_bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                               find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison table</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wilcoxon rank-sum"</span>, <span class="st">"Bootstrap-t"</span>, <span class="st">"Bayes factor"</span><span class="op">)</span>,</span>
<span>  `Median Power` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">power_wilcox</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">power_boot</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">power_bayes</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  `% &gt; 50% Power` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">power_wilcox</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">power_boot</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">power_bayes</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span>,</span>
<span>  `% &gt; 80% Power` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">power_wilcox</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span> <span class="op">&gt;</span> <span class="fl">0.8</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">power_boot</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span> <span class="op">&gt;</span> <span class="fl">0.8</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">power_bayes</span><span class="op">$</span><span class="va">simulations</span><span class="op">$</span><span class="va">peptide_power</span> <span class="op">&gt;</span> <span class="fl">0.8</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison</span>, digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             caption <span class="op">=</span> <span class="st">"Power comparison across statistical tests (N=3, 2-fold effect)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Power comparison across statistical tests (N=3, 2-fold
effect)</caption>
<thead><tr class="header">
<th align="left">Test</th>
<th align="right">Median Power</th>
<th align="right">% &gt; 50% Power</th>
<th align="right">% &gt; 80% Power</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Wilcoxon rank-sum</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">Bootstrap-t</td>
<td align="right">0.15</td>
<td align="right">2.68</td>
<td align="right">0.11</td>
</tr>
<tr class="odd">
<td align="left">Bayes factor</td>
<td align="right">0.47</td>
<td align="right">40.73</td>
<td align="right">5.79</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="understanding-the-test-comparison-results">Understanding the Test Comparison Results<a class="anchor" aria-label="anchor" href="#understanding-the-test-comparison-results"></a>
</h3>
<p>The comparison table reveals important insights:</p>
<ul>
<li><p><strong>Wilcoxon rank-sum</strong> is conservative with small
samples. Non-parametric tests don’t make distributional assumptions, but
this comes at a cost: they need more data to achieve comparable
power.</p></li>
<li><p><strong>Bootstrap-t</strong> uses resampling to handle
non-normality, potentially offering better power than Wilcoxon.</p></li>
<li><p><strong>Bayes factor</strong> tests provide evidence for or
against an effect. At small N, Bayesian approaches can be more
informative than frequentist tests.</p></li>
</ul>
<p><strong>Recommendation:</strong> For the remaining analyses in this
document, we use the Bayes factor test since it provides usable power
estimates at N=3.</p>
</div>
<div class="section level3">
<h3 id="the-three-questions">The Three Questions<a class="anchor" aria-label="anchor" href="#the-three-questions"></a>
</h3>
<p>Power analysis can answer three related questions about experimental
design:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Power:</strong> Given sample size and effect size, what is
my power?</li>
<li>
<strong>Sample size:</strong> Given target power and effect size,
what N do I need?</li>
<li>
<strong>Minimum detectable effect:</strong> Given sample size and
target power, what’s the smallest effect I can detect?</li>
</ol>
<p>These questions are mathematically related - fixing any three
parameters determines the fourth.</p>
</div>
<div class="section level3">
<h3 id="question-1-current-power-n3">Question 1: Current Power (N=3)<a class="anchor" aria-label="anchor" href="#question-1-current-power-n3"></a>
</h3>
<p>With 3 biological replicates per group (as in this experiment), what
power do we have to detect a 2-fold change?</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using Bayes factor test based on our comparison results</span></span>
<span><span class="va">power_n3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">power_n3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## peppwr_power analysis</span></span>
<span><span class="co">## ---------------------</span></span>
<span><span class="co">## Mode: per_peptide</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Power: 51%</span></span>
<span><span class="co">## Sample size: 3 per group</span></span>
<span><span class="co">## Effect size: 2.00-fold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistical test: bayes_t</span></span>
<span><span class="co">## Decision threshold: BF &gt; 3 (substantial evidence)</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">power_n3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/plot-power-n3-1.png" class="r-plt" alt="Distribution of power across peptides with N=3 and 2-fold effect (Bayes factor test). Each bar represents the proportion of peptides achieving that power level." width="768"><p class="caption">
Distribution of power across peptides with N=3 and 2-fold effect (Bayes
factor test). Each bar represents the proportion of peptides achieving
that power level.
</p>
</div>
<p>With N=3, power to detect a 2-fold change varies across peptides.
Peptides with lower variability will have higher power, while noisy
peptides remain under-powered.</p>
</div>
<div class="section level3">
<h3 id="question-2-sample-size-for-target-power">Question 2: Sample Size for Target Power<a class="anchor" aria-label="anchor" href="#question-2-sample-size-for-target-power"></a>
</h3>
<p>What sample size would we need to achieve 80% power to detect a
2-fold change for most peptides?</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                              find <span class="op">=</span> <span class="st">"sample_size"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## peppwr_power analysis</span></span>
<span><span class="co">## ---------------------</span></span>
<span><span class="co">## Mode: per_peptide</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Recommended sample size: N=15 per group</span></span>
<span><span class="co">## Target power: 80%</span></span>
<span><span class="co">## Effect size: 2.00-fold</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistical test: bayes_t</span></span>
<span><span class="co">## Decision threshold: BF &gt; 3 (substantial evidence)</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/plot-sample-size-1.png" class="r-plt" alt="Percentage of peptides reaching 80% power at each sample size. The curve shows diminishing returns as N increases." width="768"><p class="caption">
Percentage of peptides reaching 80% power at each sample size. The curve
shows diminishing returns as N increases.
</p>
</div>
<p>This curve directly answers “what percentage of my peptides will be
well-powered at sample size N?” - useful for experimental planning when
budget constraints limit replication.</p>
</div>
<div class="section level3">
<h3 id="question-3-minimum-detectable-effect">Question 3: Minimum Detectable Effect<a class="anchor" aria-label="anchor" href="#question-3-minimum-detectable-effect"></a>
</h3>
<p>At N=3 with 80% power target, what’s the smallest effect we can
reliably detect?</p>
<p><strong>Understanding the two thresholds:</strong> In per-peptide
mode, there are two distinct thresholds:</p>
<ol style="list-style-type: decimal">
<li>
<strong><code>target_power</code></strong> (set to 0.8) - The power
level each individual peptide must achieve</li>
<li>
<strong><code>proportion_threshold</code></strong> (default 0.5) -
The fraction of peptides that must reach <code>target_power</code>
</li>
</ol>
<p>The plot shows “% of peptides reaching 80% power” on the y-axis. The
answer tells us: “At what effect size do 50% of peptides achieve 80%
power?”</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>, target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                             find <span class="op">=</span> <span class="st">"effect_size"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">min_effect</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## peppwr_power analysis</span></span>
<span><span class="co">## ---------------------</span></span>
<span><span class="co">## Mode: per_peptide</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Minimum detectable effect: 10.00-fold</span></span>
<span><span class="co">## Sample size: 3 per group</span></span>
<span><span class="co">## Target power: 80%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistical test: bayes_t</span></span>
<span><span class="co">## Decision threshold: BF &gt; 3 (substantial evidence)</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">min_effect</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/plot-min-effect-1.png" class="r-plt" alt="Proportion of peptides reaching 80% power at each effect size. The default threshold is 50% of peptides (proportion_threshold = 0.5)." width="768"><p class="caption">
Proportion of peptides reaching 80% power at each effect size. The
default threshold is 50% of peptides (proportion_threshold = 0.5).
</p>
</div>
<p>With only N=3, very large effects are needed for a majority of
peptides to be well-powered. This is a realistic but sobering assessment
of what under-powered experiments can detect.</p>
<p>To require a higher fraction of peptides to be well-powered, increase
<code>proportion_threshold</code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Require 80% of peptides to reach 80% power (stricter)</span></span>
<span><span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>, target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>               find <span class="op">=</span> <span class="st">"effect_size"</span>, proportion_threshold <span class="op">=</span> <span class="fl">0.8</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="power-heatmap">Power Heatmap<a class="anchor" aria-label="anchor" href="#power-heatmap"></a>
</h2>
<p>A power heatmap visualizes how power varies across combinations of
sample size and effect size - useful for identifying the “sweet spot”
for experimental design.</p>
<div class="section level3">
<h3 id="why-aggregate-mode-for-heatmaps">Why Aggregate Mode for Heatmaps?<a class="anchor" aria-label="anchor" href="#why-aggregate-mode-for-heatmaps"></a>
</h3>
<p>The <code><a href="../reference/plot_power_heatmap.html">plot_power_heatmap()</a></code> function uses <strong>aggregate
mode</strong> (single distribution) rather than per-peptide mode
because:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Computational cost</strong>: Per-peptide heatmaps would
require millions of simulations</li>
<li>
<strong>Visualization</strong>: A single heatmap is more
interpretable than 2000+ individual heatmaps</li>
<li>
<strong>Purpose</strong>: Heatmaps answer “what’s the general
tradeoff?” not “what’s the power for peptide X?”</li>
</ol>
<p>To make the heatmap relevant to your data, we derive representative
parameters from the fitted distributions:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Derive representative parameters from the data</span></span>
<span><span class="va">log_abundances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span><span class="op">[</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">derived_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">log_abundances</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/mad.html" class="external-link">mad</a></span><span class="op">(</span><span class="va">log_abundances</span>, constant <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># robust SD estimate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Using representative lognormal parameters:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using representative lognormal parameters:</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  meanlog ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">derived_params</span><span class="op">$</span><span class="va">meanlog</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   meanlog = 13.72</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  sdlog ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">derived_params</span><span class="op">$</span><span class="va">sdlog</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sdlog = 1.41</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate heatmap with data-derived parameters</span></span>
<span><span class="fu"><a href="../reference/plot_power_heatmap.html">plot_power_heatmap</a></span><span class="op">(</span></span>
<span>  distribution <span class="op">=</span> <span class="st">"lnorm"</span>,</span>
<span>  params <span class="op">=</span> <span class="va">derived_params</span>,</span>
<span>  n_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  effect_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"wilcoxon"</span>  <span class="co"># heatmap uses aggregate mode</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dda-time-course-power_files/figure-html/power-heatmap-1.png" class="r-plt" alt="Power as a function of sample size and effect size for a representative peptide. Colors indicate expected power. Individual peptides will vary based on their specific variability." width="768"><p class="caption">
Power as a function of sample size and effect size for a representative
peptide. Colors indicate expected power. Individual peptides will vary
based on their specific variability.
</p>
</div>
</div>
<div class="section level3">
<h3 id="interpreting-the-heatmap">Interpreting the Heatmap<a class="anchor" aria-label="anchor" href="#interpreting-the-heatmap"></a>
</h3>
<p>The heatmap shows power for a <strong>representative peptide</strong>
with typical abundance characteristics. Individual peptides will
vary:</p>
<ul>
<li>Low-variability peptides will have higher power than shown</li>
<li>High-variability peptides will have lower power than shown</li>
<li>Use the per-peptide <code>find = "power"</code> results to
understand the distribution across peptides</li>
</ul>
<p>The heatmap shows:</p>
<ul>
<li>
<strong>Lower-left corner</strong> (small N, small effect): Low
power - avoid this region</li>
<li>
<strong>Upper-right corner</strong> (large N, large effect): High
power but potentially wasteful</li>
<li>
<strong>Diagonal transition zone</strong>: The practical planning
region where tradeoffs matter</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="summary-and-recommendations">Summary and Recommendations<a class="anchor" aria-label="anchor" href="#summary-and-recommendations"></a>
</h2>
<div class="section level3">
<h3 id="key-findings">Key Findings<a class="anchor" aria-label="anchor" href="#key-findings"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p><strong>Distribution fitting:</strong> With only 6 observations
per peptide, distribution selection is unreliable. The observed “best
fit” distributions are artifacts of small sample size, not the true
underlying distributions.</p></li>
<li><p><strong>Test selection matters:</strong> Wilcoxon rank-sum may
have limited power at N=3 due to its conservative nature. Bayes factor
tests can provide more informative power estimates with small
samples.</p></li>
<li><p><strong>Current power (N=3):</strong> With 3 replicates and the
Bayes factor test, power to detect a 2-fold change varies across
peptides based on their individual variability.</p></li>
<li><p><strong>Sample size requirements:</strong> Achieving consistently
high power (80%+) across most peptides requires more than N=3 biological
replicates.</p></li>
<li><p><strong>Minimum detectable effect:</strong> At N=3, only
relatively large fold changes can be reliably detected at 80% power for
most peptides.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="practical-recommendations">Practical Recommendations<a class="anchor" aria-label="anchor" href="#practical-recommendations"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p><strong>For future experiments:</strong> Consider N=6 or more
biological replicates if detecting smaller fold changes (&lt;2-fold) is
important.</p></li>
<li><p><strong>For current data interpretation:</strong> Results showing
non-significance may reflect insufficient power rather than absence of
biological effect. Be cautious about concluding “no
difference.”</p></li>
<li><p><strong>Test selection:</strong> With small samples, consider
Bayes factor tests which may be more informative than traditional
frequentist tests.</p></li>
<li><p><strong>Effect size expectations:</strong> Set realistic
expectations - detecting subtle changes requires adequate
replication.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h3>
<ul>
<li>This analysis uses a single genotype (Col-0) and specific timepoint
comparison (0 vs 600)</li>
<li>Distribution fitting is limited by small sample size (6 observations
per peptide)</li>
<li>Power estimates assume fitted distributions accurately represent
underlying biology</li>
<li>Technical variability (not modeled here) may further reduce
effective power</li>
<li>Real experimental factors (batch effects, sample quality) are not
captured</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices datasets  utils     methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] tibble_3.3.1  ggplot2_4.0.2 dplyr_1.2.0   peppwR_0.1.0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] utf8_1.2.6          sass_0.4.10         generics_0.1.4     </span></span>
<span><span class="co">##  [4] tidyr_1.3.2         renv_0.12.2         lattice_0.22-7     </span></span>
<span><span class="co">##  [7] fGarch_4052.93      digest_0.6.39       magrittr_2.0.4     </span></span>
<span><span class="co">## [10] evaluate_1.0.5      grid_4.5.2          RColorBrewer_1.1-3 </span></span>
<span><span class="co">## [13] fastmap_1.2.0       Matrix_1.7-4        jsonlite_2.0.0     </span></span>
<span><span class="co">## [16] purrr_1.2.1         scales_1.4.0        gbutils_0.5.1      </span></span>
<span><span class="co">## [19] textshaping_1.0.4   jquerylib_0.1.4     Rdpack_2.6.6       </span></span>
<span><span class="co">## [22] cli_3.6.5           timeSeries_4052.112 rlang_1.1.7        </span></span>
<span><span class="co">## [25] rbibutils_2.4.1     intervals_0.15.5    withr_3.0.2        </span></span>
<span><span class="co">## [28] cachem_1.1.0        yaml_2.3.12         cvar_0.6           </span></span>
<span><span class="co">## [31] tools_4.5.2         assertthat_0.2.1    vctrs_0.7.1        </span></span>
<span><span class="co">## [34] R6_2.6.1            lifecycle_1.0.5     fs_1.6.6           </span></span>
<span><span class="co">## [37] univariateML_1.5.0  ragg_1.5.0          pkgconfig_2.0.3    </span></span>
<span><span class="co">## [40] desc_1.4.3          pkgdown_2.2.0       pillar_1.11.1      </span></span>
<span><span class="co">## [43] bslib_0.10.0        gtable_0.3.6        glue_1.8.0         </span></span>
<span><span class="co">## [46] systemfonts_1.3.1   xfun_0.56           tidyselect_1.2.1   </span></span>
<span><span class="co">## [49] knitr_1.51          farver_2.1.2        spatial_7.3-18     </span></span>
<span><span class="co">## [52] htmltools_0.5.9     fBasics_4052.98     rmarkdown_2.30     </span></span>
<span><span class="co">## [55] labeling_0.4.3      timeDate_4052.112   compiler_4.5.2     </span></span>
<span><span class="co">## [58] S7_0.2.1</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan MacLean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
