<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Power Analysis Workflow • peppwR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Power Analysis Workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">peppwR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/find-fits.html">Distribution Fitting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>In-depth Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/power-analysis-workflow.html">Power Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking.html">Benchmarking</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danmaclean/peppwR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Power Analysis Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/danmaclean/peppwR/blob/master/vignettes/articles/power-analysis-workflow.Rmd" class="external-link"><code>vignettes/articles/power-analysis-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>power-analysis-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://danmaclean.github.io/peppwR/">peppwR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>peppwR addresses three fundamental power analysis questions:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Sample size</strong>: “What sample size do I need to achieve
target power?”</li>
<li>
<strong>Power</strong>: “What power do I have at a given sample
size?”</li>
<li>
<strong>Effect size</strong>: “What’s the minimum detectable effect
at given power and sample size?”</li>
</ol>
<p>The package offers two modes of analysis:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="30%">
<col width="43%">
</colgroup>
<thead><tr class="header">
<th>Mode</th>
<th>Input</th>
<th>Use Case</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Aggregate</strong></td>
<td>Distribution + parameters</td>
<td>No pilot data; quick estimates</td>
</tr>
<tr class="even">
<td><strong>Per-peptide</strong></td>
<td>Pilot data via <code>peppwr_fits</code>
</td>
<td>Realistic, peptide-specific estimates</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="aggregate-mode-deep-dive">Aggregate Mode Deep Dive<a class="anchor" aria-label="anchor" href="#aggregate-mode-deep-dive"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-aggregate-mode">When to Use Aggregate Mode<a class="anchor" aria-label="anchor" href="#when-to-use-aggregate-mode"></a>
</h3>
<ul>
<li>Planning a new experiment without pilot data</li>
<li>Quick ballpark estimates needed</li>
<li>Comparing different experimental scenarios</li>
<li>Teaching or demonstration purposes</li>
</ul>
</div>
<div class="section level3">
<h3 id="choosing-distribution-parameters">Choosing Distribution Parameters<a class="anchor" aria-label="anchor" href="#choosing-distribution-parameters"></a>
</h3>
<p>For phosphoproteomics, gamma distributions are common. Typical
parameters:</p>
<table class="table">
<thead><tr class="header">
<th>Scenario</th>
<th>Shape</th>
<th>Rate</th>
<th>Mean Abundance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Low abundance</td>
<td>1.5-2</td>
<td>0.05-0.1</td>
<td>15-40</td>
</tr>
<tr class="even">
<td>Medium abundance</td>
<td>2-3</td>
<td>0.02-0.05</td>
<td>40-150</td>
</tr>
<tr class="odd">
<td>High abundance</td>
<td>3-5</td>
<td>0.01-0.02</td>
<td>150-500</td>
</tr>
</tbody>
</table>
<p><strong>Conservative estimates</strong> use lower shape (more skewed,
higher variance), while <strong>optimistic estimates</strong> use higher
shape (more symmetric, lower variance).</p>
</div>
<div class="section level3">
<h3 id="finding-sample-size">Finding Sample Size<a class="anchor" aria-label="anchor" href="#finding-sample-size"></a>
</h3>
<p>“How many samples per group do I need for 80% power to detect a
2-fold change?”</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  distribution <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Recommended sample size: N=25 per group</span></span>
<span><span class="co">#&gt; Target power: 80%</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/plot-sample-size-1.png" class="r-plt" alt="" width="672"></p>
<p>The power curve shows how power increases with sample size. The
recommended N is the smallest value achieving your target.</p>
</div>
<div class="section level3">
<h3 id="finding-power">Finding Power<a class="anchor" aria-label="anchor" href="#finding-power"></a>
</h3>
<p>“With N=6 per group, what’s my power to detect a 2-fold change?”</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  distribution <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 24%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="finding-minimum-detectable-effect">Finding Minimum Detectable Effect<a class="anchor" aria-label="anchor" href="#finding-minimum-detectable-effect"></a>
</h3>
<p>“With N=6 and 80% target power, what’s the smallest effect I can
reliably detect?”</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  distribution <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"effect_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Minimum detectable effect: 5.00-fold</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Target power: 80%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/plot-effect-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level3">
<h3 id="sensitivity-to-parameter-choices">Sensitivity to Parameter Choices<a class="anchor" aria-label="anchor" href="#sensitivity-to-parameter-choices"></a>
</h3>
<p>Let’s see how results change with different distribution
assumptions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Conservative (high variance)</span></span>
<span><span class="va">conservative</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1.5</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Moderate</span></span>
<span><span class="va">moderate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2.5</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optimistic (low variance)</span></span>
<span><span class="va">optimistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">4</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Conservative (shape=1.5): N ="</span>, <span class="va">conservative</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Conservative (shape=1.5): N = 30 per group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Moderate (shape=2.5):     N ="</span>, <span class="va">moderate</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Moderate (shape=2.5):     N = 20 per group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Optimistic (shape=4):     N ="</span>, <span class="va">optimistic</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Optimistic (shape=4):     N = 12 per group</span></span></code></pre></div>
<p>When unsure, use conservative estimates to avoid underpowered
experiments.</p>
</div>
</div>
<div class="section level2">
<h2 id="per-peptide-mode-deep-dive">Per-Peptide Mode Deep Dive<a class="anchor" aria-label="anchor" href="#per-peptide-mode-deep-dive"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-per-peptide-mode">When to Use Per-Peptide Mode<a class="anchor" aria-label="anchor" href="#when-to-use-per-peptide-mode"></a>
</h3>
<ul>
<li>You have pilot data from similar experiments</li>
<li>Peptide heterogeneity is expected</li>
<li>You want realistic power estimates across your peptidome</li>
<li>Planning follow-up studies</li>
</ul>
</div>
<div class="section level3">
<h3 id="step-1-distribution-fitting">Step 1: Distribution Fitting<a class="anchor" aria-label="anchor" href="#step-1-distribution-fitting"></a>
</h3>
<p>First, fit distributions to your pilot data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate heterogeneous pilot data</span></span>
<span><span class="va">n_peptides</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">n_per_group</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">peptide_params</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  peptide_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pep_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%04d"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_peptides</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_peptides</span>, <span class="fl">1.5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_peptides</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pilot_data</span> <span class="op">&lt;-</span> <span class="va">peptide_params</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"treatment"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_per_group</span><span class="op">)</span>,</span>
<span>      replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_per_group</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_per_group</span> <span class="op">*</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="va">shape</span>, rate <span class="op">=</span> <span class="va">rate</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">peptide_id</span>, <span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>We use <code>distributions = "continuous"</code> for abundance data.
Use <code>"counts"</code> if you have count-based quantification (e.g.,
spectral counts).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span></span>
<span>  <span class="va">pilot_data</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"peptide_id"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>  distributions <span class="op">=</span> <span class="st">"continuous"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: intervals</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_fits object</span></span>
<span><span class="co">#&gt; ------------------</span></span>
<span><span class="co">#&gt; 200 peptides fitted</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Best fit distribution counts:</span></span>
<span><span class="co">#&gt;   Gamma: 13</span></span>
<span><span class="co">#&gt;   Normal: 22</span></span>
<span><span class="co">#&gt;   Pareto: 124</span></span>
<span><span class="co">#&gt;   Skew Normal: 41</span></span></code></pre></div>
<p><strong>Note on distribution detection:</strong> With n=4 per group
(8 observations total), distribution selection has uncertainty. You may
see distributions like Pareto or Skew Normal selected even when the true
underlying distribution is Gamma. This is normal - the fitted parameters
are still useful for power simulation. With larger samples (n≥15 per
group), the correct distribution family is more reliably identified.</p>
</div>
<div class="section level3">
<h3 id="understanding-fit-results">Understanding Fit Results<a class="anchor" aria-label="anchor" href="#understanding-fit-results"></a>
</h3>
<p>The print output shows: - Total peptides fitted - Distribution of
best-fit models - Any fit failures</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of peppwr_fits</span></span>
<span><span class="co">#&gt; ======================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Peptides fitted: 200</span></span>
<span><span class="co">#&gt; Failed fits: 0 (0.0%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Best distribution counts:</span></span>
<span><span class="co">#&gt;   Gamma: 13</span></span>
<span><span class="co">#&gt;   Normal: 22</span></span>
<span><span class="co">#&gt;   Pareto: 124</span></span>
<span><span class="co">#&gt;   Skew Normal: 41</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit statistics:</span></span>
<span><span class="co">#&gt;   AIC range: [17.6, Inf]</span></span>
<span><span class="co">#&gt;   AIC median: 40.5</span></span>
<span><span class="co">#&gt;   LogLik range: [-Inf, -5.9]</span></span>
<span><span class="co">#&gt;   LogLik median: -18.1</span></span></code></pre></div>
<p>The summary provides detailed statistics including AIC ranges and
median values.</p>
</div>
<div class="section level3">
<h3 id="step-2-per-peptide-power-analysis">Step 2: Per-Peptide Power Analysis<a class="anchor" aria-label="anchor" href="#step-2-per-peptide-power-analysis"></a>
</h3>
<p>Now use the fits for power analysis:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="va">fits</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_pp</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: per_peptide</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 55%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_pp</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/plot-pp-power-1.png" class="r-plt" alt="" width="672"></p>
<p>The histogram shows the distribution of power across peptides. Note
that power varies substantially - some peptides achieve near 100% power
while others remain underpowered.</p>
</div>
<div class="section level3">
<h3 id="finding-sample-size-per-peptide">Finding Sample Size (Per-Peptide)<a class="anchor" aria-label="anchor" href="#finding-sample-size-per-peptide"></a>
</h3>
<p>“What sample size gives 80% power for most peptides?”</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="va">fits</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_n</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: per_peptide</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Recommended sample size: N=12 per group</span></span>
<span><span class="co">#&gt; Target power: 80%</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_n</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/plot-pp-sample-size-1.png" class="r-plt" alt="" width="672"></p>
<p>This “peptide threshold curve” shows what proportion of peptides
achieve target power at each sample size. The 50% line indicates where
the majority of peptides become well-powered.</p>
</div>
<div class="section level3">
<h3 id="interpreting-per-peptide-results">Interpreting Per-Peptide Results<a class="anchor" aria-label="anchor" href="#interpreting-per-peptide-results"></a>
</h3>
<p>Key insights from per-peptide analysis:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Heterogeneity</strong>: Power varies across peptides due to
different underlying distributions</li>
<li>
<strong>Majority rule</strong>: The recommended N aims to power the
majority (50%+) of peptides</li>
<li>
<strong>Underpowered fraction</strong>: Some peptides may never
achieve target power at practical sample sizes</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="comparing-the-two-modes">Comparing the Two Modes<a class="anchor" aria-label="anchor" href="#comparing-the-two-modes"></a>
</h2>
<p>Let’s run both modes on the same data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate mode with "typical" parameters</span></span>
<span><span class="va">agg_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2.5</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Per-peptide mode</span></span>
<span><span class="va">pp_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="va">fits</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Aggregate mode:   N ="</span>, <span class="va">agg_result</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Aggregate mode:   N = 20 per group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Per-peptide mode: N ="</span>, <span class="va">pp_result</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Per-peptide mode: N = 12 per group</span></span></code></pre></div>
<div class="section level3">
<h3 id="when-results-disagree">When Results Disagree<a class="anchor" aria-label="anchor" href="#when-results-disagree"></a>
</h3>
<ul>
<li>
<strong>Per-peptide &gt; Aggregate</strong>: Your peptidome is more
heterogeneous than assumed</li>
<li>
<strong>Aggregate &gt; Per-peptide</strong>: Your assumed parameters
were conservative</li>
<li>
<strong>Large disagreement</strong>: Reconsider your aggregate
assumptions</li>
</ul>
<p><strong>Recommendation</strong>: When pilot data is available, trust
per-peptide results.</p>
</div>
</div>
<div class="section level2">
<h2 id="statistical-test-options">Statistical Test Options<a class="anchor" aria-label="anchor" href="#statistical-test-options"></a>
</h2>
<p>peppwR supports multiple statistical tests:</p>
<table class="table">
<colgroup>
<col width="30%">
<col width="20%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Test</th>
<th>ID</th>
<th>Best For</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Wilcoxon rank-sum</td>
<td><code>"wilcoxon"</code></td>
<td>General purpose, robust to non-normality</td>
</tr>
<tr class="even">
<td>Bootstrap-t</td>
<td><code>"bootstrap_t"</code></td>
<td>Non-normal data, small samples</td>
</tr>
<tr class="odd">
<td>Bayes factor</td>
<td><code>"bayes_t"</code></td>
<td>Evidence quantification</td>
</tr>
<tr class="even">
<td>Rank products</td>
<td><code>"rankprod"</code></td>
<td>Omics data, designed for small samples</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="default-wilcoxon-test">Default: Wilcoxon Test<a class="anchor" aria-label="anchor" href="#default-wilcoxon-test"></a>
</h3>
<p>The Wilcoxon rank-sum test is the default because it: - Makes no
distributional assumptions - Is robust to outliers - Works well with
small samples typical of proteomics</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_wilcox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"wilcoxon"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_wilcox</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 24%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bootstrap-t-test">Bootstrap-t Test<a class="anchor" aria-label="anchor" href="#bootstrap-t-test"></a>
</h3>
<p>For small samples with non-normal data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"bootstrap_t"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_boot</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 28%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: bootstrap_t</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bayes-factor-test">Bayes Factor Test<a class="anchor" aria-label="anchor" href="#bayes-factor-test"></a>
</h3>
<p>The Bayes factor test provides evidence strength rather than a
p-value. A result is considered “significant” when BF &gt; 3
(substantial evidence).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"bayes_t"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_bayes</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 58%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: bayes_t</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rank-products-test">Rank Products Test<a class="anchor" aria-label="anchor" href="#rank-products-test"></a>
</h3>
<p>Designed specifically for omics experiments:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"rankprod"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_rp</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: aggregate</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 31%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: rankprod</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="diagnostic-plots">Diagnostic Plots<a class="anchor" aria-label="anchor" href="#diagnostic-plots"></a>
</h2>
<p>peppwR provides several diagnostic plots to assess fit quality and
explore power landscapes.</p>
<div class="section level3">
<h3 id="assessing-fit-quality">Assessing Fit Quality<a class="anchor" aria-label="anchor" href="#assessing-fit-quality"></a>
</h3>
<p>After fitting distributions, verify that the fits are reasonable:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>  <span class="co"># For reproducible peptide selection</span></span>
<span></span>
<span><span class="co"># Histogram with fitted density overlay</span></span>
<span><span class="fu"><a href="../reference/plot_density_overlay.html">plot_density_overlay</a></span><span class="op">(</span><span class="va">fits</span>, n_overlay <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/density-overlay-1.png" class="r-plt" alt="" width="672"></p>
<p>The density overlay shows the observed histogram (blue) with the
fitted distribution curve (red). Good fits show the curve closely
following the histogram shape.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># QQ plots for goodness-of-fit</span></span>
<span><span class="fu"><a href="../reference/plot_qq.html">plot_qq</a></span><span class="op">(</span><span class="va">fits</span>, n_plots <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/qq-plots-1.png" class="r-plt" alt="" width="672"></p>
<p>In a QQ plot, points should fall along the diagonal line. Systematic
deviations indicate poor fit: - S-shaped curve: Distribution has wrong
tail behavior - Points above line at right: Heavy right tail in data -
Points below line at left: Heavy left tail in data</p>
</div>
<div class="section level3">
<h3 id="distribution-of-fit-statistics">Distribution of Fit Statistics<a class="anchor" aria-label="anchor" href="#distribution-of-fit-statistics"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># AIC distribution across the peptidome by best-fit distribution</span></span>
<span><span class="fu"><a href="../reference/plot_param_distribution.html">plot_param_distribution</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/param-distribution-1.png" class="r-plt" alt="" width="672"></p>
<p>This shows how AIC values are distributed across peptides, grouped by
their best-fitting distribution.</p>
</div>
<div class="section level3">
<h3 id="exploring-power-landscapes">Exploring Power Landscapes<a class="anchor" aria-label="anchor" href="#exploring-power-landscapes"></a>
</h3>
<p>For planning purposes, you can visualize how power varies across
sample sizes and effect sizes:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Power heatmap: sample size vs effect size grid</span></span>
<span><span class="fu"><a href="../reference/plot_power_heatmap.html">plot_power_heatmap</a></span><span class="op">(</span></span>
<span>  distribution <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  n_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  effect_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  n_steps <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/power-heatmap-1.png" class="r-plt" alt="" width="672"></p>
<p>The heatmap provides a quick lookup table for power at different
experimental designs.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First create a result to use</span></span>
<span><span class="va">result_for_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Power sensitivity at fixed sample size</span></span>
<span><span class="fu"><a href="../reference/plot_power_vs_effect.html">plot_power_vs_effect</a></span><span class="op">(</span><span class="va">result_for_plot</span>, effect_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">4</span><span class="op">)</span>, n_sim <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/power-vs-effect-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="handling-missing-data">Handling Missing Data<a class="anchor" aria-label="anchor" href="#handling-missing-data"></a>
</h2>
<p>Proteomics data often contains missing values, particularly for
low-abundance peptides near the detection limit. peppwR tracks and
models missingness to provide more realistic power estimates.</p>
<div class="section level3">
<h3 id="understanding-missingness">Understanding Missingness<a class="anchor" aria-label="anchor" href="#understanding-missingness"></a>
</h3>
<p>The <code><a href="../reference/fit_distributions.html">fit_distributions()</a></code> function automatically computes
missingness statistics for each peptide:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fits object includes missingness statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_fits object</span></span>
<span><span class="co">#&gt; ------------------</span></span>
<span><span class="co">#&gt; 200 peptides fitted</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Best fit distribution counts:</span></span>
<span><span class="co">#&gt;   Gamma: 13</span></span>
<span><span class="co">#&gt;   Normal: 22</span></span>
<span><span class="co">#&gt;   Pareto: 124</span></span>
<span><span class="co">#&gt;   Skew Normal: 41</span></span>
<span></span>
<span><span class="co"># Detailed missingness summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span><span class="op">$</span><span class="va">missingness</span></span>
<span><span class="co">#&gt; $total_missing</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_values</span></span>
<span><span class="co">#&gt; [1] 800</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mean_na_rate</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $median_na_rate</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_na_rate</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_peptides_with_na</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mean_mnar_score</span></span>
<span><span class="co">#&gt; [1] NaN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_potential_mnar</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-missingness-patterns">Visualizing Missingness Patterns<a class="anchor" aria-label="anchor" href="#visualizing-missingness-patterns"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize NA rate and MNAR score distributions</span></span>
<span><span class="fu"><a href="../reference/plot_missingness.html">plot_missingness</a></span><span class="op">(</span><span class="va">fits_na</span><span class="op">)</span></span></code></pre></div>
<p><img src="power-analysis-workflow_files/figure-html/plot-missingness-1.png" class="r-plt" alt="" width="672"></p>
<p>The plot shows three panels:</p>
<ul>
<li>
<strong>Top</strong>: Distribution of NA rates across peptides</li>
<li>
<strong>Middle</strong>: MNAR score histogram - scores above 2 (red
line) suggest systematic missingness</li>
<li>
<strong>Bottom</strong>: Mean abundance vs NA rate, colored by MNAR
score. A negative trend (low abundance → high NA rate) is the hallmark
of MNAR in proteomics</li>
</ul>
</div>
<div class="section level3">
<h3 id="mnar-detection">MNAR Detection<a class="anchor" aria-label="anchor" href="#mnar-detection"></a>
</h3>
<p>MNAR (Missing Not At Random) occurs when the probability of a value
being missing depends on the value itself. In proteomics, this typically
happens when low-abundance peptides fall below the detection limit.</p>
<p>peppwR detects MNAR patterns by comparing the mean rank of observed
values to what would be expected under random (MCAR) missingness. A
positive MNAR score indicates that observed values tend to be higher
than expected - suggesting low values are preferentially missing.</p>
<p>To identify specific peptides showing MNAR evidence:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get peptides with MNAR score &gt; 2</span></span>
<span><span class="va">mnar_peptides</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mnar_peptides.html">get_mnar_peptides</a></span><span class="op">(</span><span class="va">fits_na</span>, threshold <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mnar_peptides</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># View top MNAR candidates (if any)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mnar_peptides</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 variables: peptide_id &lt;chr&gt;, condition &lt;chr&gt;, na_rate &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   mnar_score &lt;dbl&gt;, mean_abundance &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="incorporating-missingness-into-simulations">Incorporating Missingness into Simulations<a class="anchor" aria-label="anchor" href="#incorporating-missingness-into-simulations"></a>
</h3>
<p>For more realistic power estimates, you can incorporate
peptide-specific NA rates:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Power analysis accounting for expected NA rates</span></span>
<span><span class="va">result_na</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="va">fits_na</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  include_missingness <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_na</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: per_peptide</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 51%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span></code></pre></div>
<p>When <code>include_missingness = TRUE</code>, simulations incorporate
each peptide’s observed NA rate and MNAR pattern, providing power
estimates that reflect what you’d actually observe in your
experiment.</p>
</div>
</div>
<div class="section level2">
<h2 id="fdr-aware-power-analysis">FDR-Aware Power Analysis<a class="anchor" aria-label="anchor" href="#fdr-aware-power-analysis"></a>
</h2>
<p>Standard power analysis computes per-peptide power at nominal alpha
(e.g., 0.05). However, with thousands of peptides, you’ll apply multiple
testing correction - which affects your effective power.</p>
<div class="section level3">
<h3 id="the-multiple-testing-problem">The Multiple Testing Problem<a class="anchor" aria-label="anchor" href="#the-multiple-testing-problem"></a>
</h3>
<p>When testing thousands of peptides: - At α = 0.05, you expect 50
false positives per 1000 true nulls - FDR correction (e.g.,
Benjamini-Hochberg) controls false discovery rate - This makes it harder
to detect true effects</p>
</div>
<div class="section level3">
<h3 id="running-fdr-adjusted-analysis">Running FDR-Adjusted Analysis<a class="anchor" aria-label="anchor" href="#running-fdr-adjusted-analysis"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="va">fits</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  apply_fdr <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prop_null <span class="op">=</span> <span class="fl">0.9</span>,       <span class="co"># 90% of peptides are true nulls</span></span>
<span>  fdr_threshold <span class="op">=</span> <span class="fl">0.05</span>,  <span class="co"># Target 5% FDR</span></span>
<span>  n_sim <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_fdr</span><span class="op">)</span></span>
<span><span class="co">#&gt; peppwr_power analysis</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Mode: per_peptide</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Power: 5%</span></span>
<span><span class="co">#&gt; Sample size: 6 per group</span></span>
<span><span class="co">#&gt; Effect size: 2.00-fold</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Significance level: 0.05</span></span>
<span><span class="co">#&gt; Statistical test: wilcoxon</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FDR-adjusted analysis (Benjamini-Hochberg)</span></span>
<span><span class="co">#&gt; Proportion true nulls: 90%</span></span>
<span><span class="co">#&gt; FDR threshold: 5%</span></span></code></pre></div>
<p>The <code>apply_fdr</code> mode simulates entire experiments with a
mixture of null and alternative peptides, then applies
Benjamini-Hochberg correction before computing power.</p>
</div>
<div class="section level3">
<h3 id="understanding-prop_null">Understanding prop_null<a class="anchor" aria-label="anchor" href="#understanding-prop_null"></a>
</h3>
<p>The <code>prop_null</code> parameter specifies what proportion of
peptides you expect to have no effect: - <code>prop_null = 0.9</code>:
10% of peptides show differential abundance -
<code>prop_null = 0.95</code>: Only 5% change (more conservative) -
<code>prop_null = 0.8</code>: 20% change (more liberal)</p>
<p>Higher <code>prop_null</code> makes FDR correction more stringent,
reducing power.</p>
</div>
<div class="section level3">
<h3 id="fdr-vs-uncorrected-power">FDR vs Uncorrected Power<a class="anchor" aria-label="anchor" href="#fdr-vs-uncorrected-power"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Uncorrected (per-peptide) power</span></span>
<span><span class="va">result_uncorr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="va">fits</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"power"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Uncorrected power: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_uncorr</span><span class="op">$</span><span class="va">answer</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"%\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; Uncorrected power: 55%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"FDR-adjusted power:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_fdr</span><span class="op">$</span><span class="va">answer</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"%\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; FDR-adjusted power:5%</span></span></code></pre></div>
<p>FDR-adjusted power is typically lower because BH correction requires
stronger evidence to call discoveries. Use FDR mode when you want to
know how many true positives you’ll actually detect after
correction.</p>
</div>
</div>
<div class="section level2">
<h2 id="handling-edge-cases">Handling Edge Cases<a class="anchor" aria-label="anchor" href="#handling-edge-cases"></a>
</h2>
<div class="section level3">
<h3 id="fit-failures">Fit Failures<a class="anchor" aria-label="anchor" href="#fit-failures"></a>
</h3>
<p>When distributions fail to fit some peptides, you have three
options:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 1: Exclude failed fits (default)</span></span>
<span><span class="va">result_exclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                 find <span class="op">=</span> <span class="st">"power"</span>, on_fit_failure <span class="op">=</span> <span class="st">"exclude"</span>, n_sim <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: Use lognormal fallback</span></span>
<span><span class="va">result_lognorm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                 find <span class="op">=</span> <span class="st">"power"</span>, on_fit_failure <span class="op">=</span> <span class="st">"lognormal"</span>, n_sim <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 3: Bootstrap from empirical data</span></span>
<span><span class="va">result_empirical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                   find <span class="op">=</span> <span class="st">"power"</span>, on_fit_failure <span class="op">=</span> <span class="st">"empirical"</span>, n_sim <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Exclude failures:    "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_exclude</span><span class="op">$</span><span class="va">answer</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"% power\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exclude failures:    55% power</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Lognormal fallback:  "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_lognorm</span><span class="op">$</span><span class="va">answer</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"% power\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; Lognormal fallback:  55% power</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Empirical bootstrap: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">result_empirical</span><span class="op">$</span><span class="va">answer</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="st">"% power\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; Empirical bootstrap: 55% power</span></span></code></pre></div>
<p><strong>Recommendations</strong>: - Start with <code>"exclude"</code>
to see how many peptides fail - Use <code>"lognormal"</code> when fit
failures are common but you have enough data points - Use
<code>"empirical"</code> when you want purely data-driven simulation
without distribution assumptions</p>
</div>
<div class="section level3">
<h3 id="very-small-pilot-datasets">Very Small Pilot Datasets<a class="anchor" aria-label="anchor" href="#very-small-pilot-datasets"></a>
</h3>
<p>With &lt;3 replicates per group: - Distribution fitting may be
unreliable - Consider aggregate mode with conservative parameters -
Increase n_sim for more stable estimates</p>
</div>
<div class="section level3">
<h3 id="extreme-effect-sizes">Extreme Effect Sizes<a class="anchor" aria-label="anchor" href="#extreme-effect-sizes"></a>
</h3>
<p>Very large effects (&gt;5-fold) typically achieve high power with
minimal samples. Very small effects (&lt;1.2-fold) may require
impractically large samples.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Large effect</span></span>
<span><span class="va">large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Small effect</span></span>
<span><span class="va">small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  find <span class="op">=</span> <span class="st">"sample_size"</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"5-fold change:   N ="</span>, <span class="va">large</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 5-fold change:   N = 6 per group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"1.2-fold change: N ="</span>, <span class="va">small</span><span class="op">$</span><span class="va">answer</span>, <span class="st">"per group\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.2-fold change: N = 50 per group</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Start with aggregate mode</strong> for quick estimates and
planning</li>
<li>
<strong>Use per-peptide mode</strong> when pilot data is available
for accurate estimates</li>
<li>
<strong>Consider heterogeneity</strong> - not all peptides behave
the same</li>
<li>
<strong>Choose appropriate tests</strong> - Wilcoxon is a safe
default</li>
<li>
<strong>Be conservative</strong> - underpowered experiments waste
resources</li>
</ol>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong>Getting Started</strong>: See
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code> for a minimal workflow</li>
<li>
<strong>Benchmarking</strong>: See
<code>vignette("benchmarking")</code> for performance with large
datasets</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan MacLean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
