<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Benchmarking peppwR • peppwR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking peppwR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">peppwR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/find-fits.html">Distribution Fitting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>In-depth Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/power-analysis-workflow.html">Power Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking.html">Benchmarking</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Real-World Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/dda-time-course-power.html">DDA Time Course Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/prm-genotype-power.html">PRM Genotype Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/TeamMacLean/peppwR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Benchmarking peppwR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TeamMacLean/peppwR/blob/master/vignettes/articles/benchmarking.Rmd" class="external-link"><code>vignettes/articles/benchmarking.Rmd</code></a></small>
      <div class="d-none name"><code>benchmarking.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://teammaclean.github.io/peppwR/">peppwR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bench.r-lib.org/" class="external-link">bench</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Proteomics datasets often contain thousands to tens of thousands of
peptides. This vignette characterizes peppwR’s performance
characteristics to help you:</p>
<ul>
<li>Estimate runtime for your dataset size</li>
<li>Choose appropriate <code>n_sim</code> values</li>
<li>Understand memory requirements</li>
<li>Make informed trade-offs between precision and compute time</li>
</ul>
</div>
<div class="section level2">
<h2 id="experimental-setup">Experimental Setup<a class="anchor" aria-label="anchor" href="#experimental-setup"></a>
</h2>
<div class="section level3">
<h3 id="test-data-generator">Test Data Generator<a class="anchor" aria-label="anchor" href="#test-data-generator"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_test_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_peptides</span>, <span class="va">n_per_group</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">42</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">peptide_params</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    peptide_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pep_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%05d"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_peptides</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_peptides</span>, <span class="fl">1.5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_peptides</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">peptide_params</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"treatment"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_per_group</span><span class="op">)</span>,</span>
<span>        replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_per_group</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_per_group</span> <span class="op">*</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="va">shape</span>, rate <span class="op">=</span> <span class="va">rate</span><span class="op">)</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">peptide_id</span>, <span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-configurations">Test Configurations<a class="anchor" aria-label="anchor" href="#test-configurations"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Peptide counts for scaling tests</span></span>
<span><span class="va">peptide_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulation counts for power analysis</span></span>
<span><span class="va">sim_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<p>Note: For practical vignette build times, we use smaller dataset
sizes than the full specification (which includes 5000, 10000, 20000
peptides). Scale estimates linearly for larger datasets.</p>
</div>
</div>
<div class="section level2">
<h2 id="distribution-fitting-scaling">Distribution Fitting Scaling<a class="anchor" aria-label="anchor" href="#distribution-fitting-scaling"></a>
</h2>
<div class="section level3">
<h3 id="generate-test-datasets">Generate Test Datasets<a class="anchor" aria-label="anchor" href="#generate-test-datasets"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">peptide_counts</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">generate_test_data</span><span class="op">(</span><span class="va">n</span>, n_per_group <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="va">peptide_counts</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmark-fitting">Benchmark Fitting<a class="anchor" aria-label="anchor" href="#benchmark-fitting"></a>
</h3>
<p>All benchmarks use <code>distributions = "continuous"</code> which
fits distributions appropriate for continuous abundance data (gamma,
lognormal, normal, etc.).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `100 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n100</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                                      distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  `500 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n500</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                                      distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  `1000 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n1000</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                                       distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  `2000 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n2000</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                                       distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  memory <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: intervals</span></span>
<span></span>
<span><span class="va">fit_results_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  peptides <span class="op">=</span> <span class="va">peptide_counts</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span>,</span>
<span>  memory_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">$</span><span class="va">mem_alloc</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_results_df</span><span class="op">$</span><span class="va">time_per_peptide_ms</span> <span class="op">&lt;-</span> <span class="va">fit_results_df</span><span class="op">$</span><span class="va">time_s</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">/</span> <span class="va">fit_results_df</span><span class="op">$</span><span class="va">peptides</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_results_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Peptides"</span>, <span class="st">"Time (s)"</span>, <span class="st">"Memory (MB)"</span>, <span class="st">"Time/peptide (ms)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Distribution fitting scaling"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Distribution fitting scaling</caption>
<thead><tr class="header">
<th align="right">Peptides</th>
<th align="right">Time (s)</th>
<th align="right">Memory (MB)</th>
<th align="right">Time/peptide (ms)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">100</td>
<td align="right">3.39</td>
<td align="right">101.29</td>
<td align="right">33.91</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">16.69</td>
<td align="right">9.75</td>
<td align="right">33.38</td>
</tr>
<tr class="odd">
<td align="right">1000</td>
<td align="right">33.06</td>
<td align="right">19.48</td>
<td align="right">33.06</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="right">65.11</td>
<td align="right">38.94</td>
<td align="right">32.56</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="fitting-scaling-plot">Fitting Scaling Plot<a class="anchor" aria-label="anchor" href="#fitting-scaling-plot"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fit_results_df</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">peptides</span>, y <span class="op">=</span> <span class="va">time_s</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of Peptides (log scale)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Time (seconds, log scale)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Distribution Fitting: Time vs Dataset Size"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="benchmarking_files/figure-html/plot-fitting-scaling-1.png" class="r-plt" alt="" width="672"></p>
<p>Distribution fitting scales approximately linearly with the number of
peptides, as each peptide is fitted independently.</p>
</div>
</div>
<div class="section level2">
<h2 id="power-analysis---aggregate-mode">Power Analysis - Aggregate Mode<a class="anchor" aria-label="anchor" href="#power-analysis---aggregate-mode"></a>
</h2>
<p>Aggregate mode performance depends primarily on <code>n_sim</code>,
not on any dataset size (since it simulates a single “typical”
peptide).</p>
<div class="section level3">
<h3 id="effect-of-n_sim">Effect of n_sim<a class="anchor" aria-label="anchor" href="#effect-of-n_sim"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">agg_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `n_sim=500` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                               effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                               find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  `n_sim=1000` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                                effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  `n_sim=2000` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                                effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">agg_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  n_sim <span class="op">=</span> <span class="va">sim_counts</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">agg_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">agg_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_sim"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Aggregate mode timing by n_sim"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Aggregate mode timing by n_sim</caption>
<thead><tr class="header">
<th align="right">n_sim</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">500</td>
<td align="right">0.051</td>
</tr>
<tr class="even">
<td align="right">1000</td>
<td align="right">0.101</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="right">0.200</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="power-estimate-stabilization">Power Estimate Stabilization<a class="anchor" aria-label="anchor" href="#power-estimate-stabilization"></a>
</h3>
<p>More simulations yield more stable power estimates. Let’s examine
convergence:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run multiple times at each n_sim level</span></span>
<span><span class="va">stabilization_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">powers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                            effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                            find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">answer</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    n_sim <span class="op">=</span> <span class="va">n</span>,</span>
<span>    mean_power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">powers</span><span class="op">)</span>,</span>
<span>    sd_power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">powers</span><span class="op">)</span>,</span>
<span>    ci_width <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">powers</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">stabilization_data</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_sim"</span>, <span class="st">"Mean Power"</span>, <span class="st">"SD"</span>, <span class="st">"95% CI Width"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Power estimate stability by n_sim"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Power estimate stability by n_sim</caption>
<thead><tr class="header">
<th align="right">n_sim</th>
<th align="right">Mean Power</th>
<th align="right">SD</th>
<th align="right">95% CI Width</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">100</td>
<td align="right">0.267</td>
<td align="right">0.063</td>
<td align="right">0.246</td>
</tr>
<tr class="even">
<td align="right">250</td>
<td align="right">0.255</td>
<td align="right">0.032</td>
<td align="right">0.127</td>
</tr>
<tr class="odd">
<td align="right">500</td>
<td align="right">0.255</td>
<td align="right">0.020</td>
<td align="right">0.078</td>
</tr>
<tr class="even">
<td align="right">1000</td>
<td align="right">0.251</td>
<td align="right">0.021</td>
<td align="right">0.082</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="right">0.254</td>
<td align="right">0.008</td>
<td align="right">0.033</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">stabilization_data</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_sim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">mean_power</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">sd_power</span>,</span>
<span>                 ymax <span class="op">=</span> <span class="va">mean_power</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">sd_power</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean_power</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"steelblue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mean_power</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of Simulations (log scale)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Power Estimate"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Power Estimate Convergence"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Shaded region shows 95% confidence interval across 10 runs"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="benchmarking_files/figure-html/plot-stabilization-1.png" class="r-plt" alt="" width="672"></p>
<p><strong>Key insight</strong>: n_sim = 1000 provides a good balance
between precision (CI width ~0.03) and speed. For publication-quality
results, use n_sim = 2000+.</p>
</div>
</div>
<div class="section level2">
<h2 id="power-analysis---per-peptide-mode">Power Analysis - Per-Peptide Mode<a class="anchor" aria-label="anchor" href="#power-analysis---per-peptide-mode"></a>
</h2>
<p>Per-peptide mode scales with both the number of peptides and
n_sim.</p>
<div class="section level3">
<h3 id="prepare-fits-for-benchmarking">Prepare Fits for Benchmarking<a class="anchor" aria-label="anchor" href="#prepare-fits-for-benchmarking"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fits_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n100</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                               distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span>
<span><span class="va">fits_500</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n500</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                               distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span>
<span><span class="va">fits_1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">$</span><span class="va">n1000</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                                distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scaling-by-peptide-count">Scaling by Peptide Count<a class="anchor" aria-label="anchor" href="#scaling-by-peptide-count"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pp_peptide_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `100 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_100</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                  find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  `500 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                  find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  `1000 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_1000</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                   find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pp_pep_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  peptides <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pp_peptide_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span>,</span>
<span>  time_per_peptide_ms <span class="op">=</span> <span class="va">time_s</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">/</span> <span class="va">peptides</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">pp_pep_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Peptides"</span>, <span class="st">"Time (s)"</span>, <span class="st">"Time/peptide (ms)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Per-peptide mode scaling by peptide count (n_sim=500)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Per-peptide mode scaling by peptide count (n_sim=500)</caption>
<thead><tr class="header">
<th align="right">Peptides</th>
<th align="right">Time (s)</th>
<th align="right">Time/peptide (ms)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">100</td>
<td align="right">4.07</td>
<td align="right">40.68</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">18.60</td>
<td align="right">37.20</td>
</tr>
<tr class="odd">
<td align="right">1000</td>
<td align="right">34.42</td>
<td align="right">34.42</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="scaling-by-n_sim">Scaling by n_sim<a class="anchor" aria-label="anchor" href="#scaling-by-n_sim"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pp_nsim_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `n_sim=250` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                               find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">250</span><span class="op">)</span>,</span>
<span>  `n_sim=500` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                               find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  `n_sim=1000` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pp_nsim_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  n_sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pp_nsim_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">pp_nsim_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_sim"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Per-peptide mode scaling by n_sim (500 peptides)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Per-peptide mode scaling by n_sim (500 peptides)</caption>
<thead><tr class="header">
<th align="right">n_sim</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">250</td>
<td align="right">9.48</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">19.04</td>
</tr>
<tr class="odd">
<td align="right">1000</td>
<td align="right">36.57</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="scaling-visualization">Scaling Visualization<a class="anchor" aria-label="anchor" href="#scaling-visualization"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pp_pep_df</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">peptides</span>, y <span class="op">=</span> <span class="va">time_s</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of Peptides (log scale)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Time (seconds, log scale)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Per-Peptide Power Analysis: Scaling with Dataset Size"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="benchmarking_files/figure-html/plot-perpeptide-scaling-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="recommendations">Recommendations<a class="anchor" aria-label="anchor" href="#recommendations"></a>
</h2>
<div class="section level3">
<h3 id="for-quick-exploratory-analysis">For Quick Exploratory Analysis<a class="anchor" aria-label="anchor" href="#for-quick-exploratory-analysis"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Recommendation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>n_sim</td>
<td>500-1000</td>
</tr>
<tr class="even">
<td>Dataset</td>
<td>Full or sub-sample if &gt; 5000 peptides</td>
</tr>
<tr class="odd">
<td>Expected time</td>
<td>~1-2 min for 1000 peptides</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="for-publication-quality-results">For Publication-Quality Results<a class="anchor" aria-label="anchor" href="#for-publication-quality-results"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Recommendation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>n_sim</td>
<td>2000-5000</td>
</tr>
<tr class="even">
<td>Dataset</td>
<td>Full peptide set</td>
</tr>
<tr class="odd">
<td>Expected time</td>
<td>~5-10 min for 1000 peptides</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="time-estimation-formula">Time Estimation Formula<a class="anchor" aria-label="anchor" href="#time-estimation-formula"></a>
</h3>
<p>For per-peptide mode:</p>
<pre><code>Estimated time (s) ≈ (n_peptides × n_sim × time_per_sim) + fitting_time</code></pre>
<p>Where: - <code>time_per_sim</code> ≈ 0.002-0.005 seconds (depends on
test type) - <code>fitting_time</code> ≈ 0.02 seconds per peptide</p>
</div>
<div class="section level3">
<h3 id="memory-considerations">Memory Considerations<a class="anchor" aria-label="anchor" href="#memory-considerations"></a>
</h3>
<ul>
<li>Fitting: ~0.1-0.2 MB per 100 peptides</li>
<li>Power analysis: Minimal additional memory (results stored per
peptide)</li>
<li>For very large datasets (&gt;10000 peptides), ensure at least 4GB
available RAM</li>
</ul>
</div>
<div class="section level3">
<h3 id="statistical-test-speed-comparison">Statistical Test Speed Comparison<a class="anchor" aria-label="anchor" href="#statistical-test-speed-comparison"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_timing</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  wilcoxon <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                            effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                            find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"wilcoxon"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  bootstrap_t <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                               effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                               find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"bootstrap_t"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  bayes_t <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                           effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                           find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  rankprod <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                            effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                            find <span class="op">=</span> <span class="st">"power"</span>, test <span class="op">=</span> <span class="st">"rankprod"</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wilcoxon"</span>, <span class="st">"bootstrap_t"</span>, <span class="st">"bayes_t"</span>, <span class="st">"rankprod"</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">test_timing</span><span class="op">$</span><span class="va">median</span><span class="op">)</span>,</span>
<span>  relative <span class="op">=</span> <span class="va">time_s</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_s</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">test_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Test"</span>, <span class="st">"Time (s)"</span>, <span class="st">"Relative Speed"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Statistical test speed comparison (n_sim=500)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Statistical test speed comparison (n_sim=500)</caption>
<thead><tr class="header">
<th align="left">Test</th>
<th align="right">Time (s)</th>
<th align="right">Relative Speed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">wilcoxon</td>
<td align="right">0.05</td>
<td align="right">2.54</td>
</tr>
<tr class="even">
<td align="left">bootstrap_t</td>
<td align="right">16.67</td>
<td align="right">874.35</td>
</tr>
<tr class="odd">
<td align="left">bayes_t</td>
<td align="right">0.02</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">rankprod</td>
<td align="right">8.64</td>
<td align="right">453.16</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: The bootstrap_t and rankprod tests are slower
due to resampling procedures. For large-scale analyses, wilcoxon or
bayes_t are faster options.</p>
</div>
</div>
<div class="section level2">
<h2 id="missingness-aware-simulation-performance">Missingness-Aware Simulation Performance<a class="anchor" aria-label="anchor" href="#missingness-aware-simulation-performance"></a>
</h2>
<p>When <code>include_missingness = TRUE</code>, peppwR incorporates
peptide-specific NA rates into simulations. Let’s measure the
overhead:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate data with realistic missingness</span></span>
<span><span class="va">generate_test_data_with_na</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_peptides</span>, <span class="va">n_per_group</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">na_rate</span> <span class="op">=</span> <span class="fl">0.15</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">42</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">generate_test_data</span><span class="op">(</span><span class="va">n_peptides</span>, <span class="va">n_per_group</span>, <span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Introduce MNAR pattern: low values more likely to be missing</span></span>
<span>  <span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">abundance</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&lt;</span> <span class="va">threshold</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">na_rate</span> <span class="op">*</span> <span class="fl">2</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">abundance</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Also some random MCAR missingness</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">na_rate</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">abundance</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">data_with_na</span> <span class="op">&lt;-</span> <span class="fu">generate_test_data_with_na</span><span class="op">(</span><span class="fl">500</span>, n_per_group <span class="op">=</span> <span class="fl">4</span>, na_rate <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="va">fits_with_na</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_distributions.html">fit_distributions</a></span><span class="op">(</span><span class="va">data_with_na</span>, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>,</span>
<span>                                   distributions <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">miss_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `Without missingness` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_with_na</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                         find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                                         include_missingness <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  `With missingness` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_with_na</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                      find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                                      include_missingness <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">miss_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Without missingness"</span>, <span class="st">"With missingness"</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">miss_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">miss_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mode"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Missingness-aware simulation overhead"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Missingness-aware simulation overhead</caption>
<thead><tr class="header">
<th align="left">Mode</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Without missingness</td>
<td align="right">5.72</td>
</tr>
<tr class="even">
<td align="left">With missingness</td>
<td align="right">7.14</td>
</tr>
</tbody>
</table>
<p>The overhead of <code>include_missingness = TRUE</code> is minimal -
it’s primarily the NA handling within the simulation loop, which is
fast.</p>
</div>
<div class="section level2">
<h2 id="fdr-mode-performance">FDR Mode Performance<a class="anchor" aria-label="anchor" href="#fdr-mode-performance"></a>
</h2>
<p>FDR-aware mode simulates entire peptidome experiments with mixed null
and alternative peptides, then applies BH correction. This is more
computationally intensive than per-peptide mode.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fdr_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `Per-peptide (no FDR)` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                          find <span class="op">=</span> <span class="st">"power"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  `FDR-adjusted` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                  find <span class="op">=</span> <span class="st">"power"</span>, apply_fdr <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  prop_null <span class="op">=</span> <span class="fl">0.9</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fdr_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Per-peptide (no FDR)"</span>, <span class="st">"FDR-adjusted"</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fdr_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">fdr_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mode"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"FDR mode vs per-peptide mode timing"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>FDR mode vs per-peptide mode timing</caption>
<thead><tr class="header">
<th align="left">Mode</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Per-peptide (no FDR)</td>
<td align="right">3.90</td>
</tr>
<tr class="even">
<td align="left">FDR-adjusted</td>
<td align="right">4.21</td>
</tr>
</tbody>
</table>
<p>FDR mode is more expensive because each simulation iteration
requires: 1. Assigning peptides to null/alternative 2. Simulating all
peptides together 3. Applying BH correction across all p-values</p>
<div class="section level3">
<h3 id="fdr-scaling-with-peptide-count">FDR Scaling with Peptide Count<a class="anchor" aria-label="anchor" href="#fdr-scaling-with-peptide-count"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fdr_scaling_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `100 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_100</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                  find <span class="op">=</span> <span class="st">"power"</span>, apply_fdr <span class="op">=</span> <span class="cn">TRUE</span>, n_sim <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  `500 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_500</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                  find <span class="op">=</span> <span class="st">"power"</span>, apply_fdr <span class="op">=</span> <span class="cn">TRUE</span>, n_sim <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  `1000 peptides` <span class="op">=</span> <span class="fu"><a href="../reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits_1000</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                   find <span class="op">=</span> <span class="st">"power"</span>, apply_fdr <span class="op">=</span> <span class="cn">TRUE</span>, n_sim <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fdr_scale_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  peptides <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fdr_scaling_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">fdr_scale_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Peptides"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"FDR mode scaling by peptide count (n_sim=50)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>FDR mode scaling by peptide count (n_sim=50)</caption>
<thead><tr class="header">
<th align="right">Peptides</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">100</td>
<td align="right">0.43</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">2.17</td>
</tr>
<tr class="odd">
<td align="right">1000</td>
<td align="right">4.01</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="diagnostic-plot-generation-times">Diagnostic Plot Generation Times<a class="anchor" aria-label="anchor" href="#diagnostic-plot-generation-times"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `Density overlay` <span class="op">=</span> <span class="fu"><a href="../reference/plot_density_overlay.html">plot_density_overlay</a></span><span class="op">(</span><span class="va">fits_500</span>, n_overlay <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>  `QQ plots` <span class="op">=</span> <span class="fu"><a href="../reference/plot_qq.html">plot_qq</a></span><span class="op">(</span><span class="va">fits_500</span>, n_plots <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>  `Param distribution` <span class="op">=</span> <span class="fu"><a href="../reference/plot_param_distribution.html">plot_param_distribution</a></span><span class="op">(</span><span class="va">fits_500</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Density overlay"</span>, <span class="st">"QQ plots"</span>, <span class="st">"Param distribution"</span><span class="op">)</span>,</span>
<span>  time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">plot_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">plot_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Plot Type"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Diagnostic plot generation times"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Diagnostic plot generation times</caption>
<thead><tr class="header">
<th align="left">Plot Type</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Density overlay</td>
<td align="right">0.059</td>
</tr>
<tr class="even">
<td align="left">QQ plots</td>
<td align="right">0.040</td>
</tr>
<tr class="odd">
<td align="left">Param distribution</td>
<td align="right">0.766</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">heatmap_results</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  `Power heatmap (5x5)` <span class="op">=</span> <span class="fu"><a href="../reference/plot_power_heatmap.html">plot_power_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="st">"gamma"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    n_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">12</span><span class="op">)</span>, effect_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    n_steps <span class="op">=</span> <span class="fl">5</span>, n_sim <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    plot <span class="op">=</span> <span class="st">"Power heatmap (5x5 grid, n_sim=50)"</span>,</span>
<span>    time_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">heatmap_results</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Plot Type"</span>, <span class="st">"Time (s)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Power heatmap generation time"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Power heatmap generation time</caption>
<thead><tr class="header">
<th align="left">Plot Type</th>
<th align="right">Time (s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Power heatmap (5x5 grid, n_sim=50)</td>
<td align="right">0.17</td>
</tr></tbody>
</table>
<p><strong>Note</strong>: The power heatmap is expensive because it runs
<code>n_steps^2 × n_sim</code> simulations. Use smaller grids and fewer
simulations for exploratory work.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices datasets  utils     methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] bench_1.1.4  peppwR_0.1.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] sass_0.4.10         generics_0.1.4      tidyr_1.3.2        </span></span>
<span><span class="co">#&gt;  [4] renv_0.12.2         fGarch_4052.93      lattice_0.22-7     </span></span>
<span><span class="co">#&gt;  [7] digest_0.6.39       magrittr_2.0.4      RColorBrewer_1.1-3 </span></span>
<span><span class="co">#&gt; [10] evaluate_1.0.5      grid_4.5.2          fastmap_1.2.0      </span></span>
<span><span class="co">#&gt; [13] jsonlite_2.0.0      Matrix_1.7-4        purrr_1.2.1        </span></span>
<span><span class="co">#&gt; [16] scales_1.4.0        gbutils_0.5.1       codetools_0.2-20   </span></span>
<span><span class="co">#&gt; [19] textshaping_1.0.4   jquerylib_0.1.4     Rdpack_2.6.5       </span></span>
<span><span class="co">#&gt; [22] cli_3.6.5           timeSeries_4052.112 rlang_1.1.7        </span></span>
<span><span class="co">#&gt; [25] rbibutils_2.4.1     intervals_0.15.5    withr_3.0.2        </span></span>
<span><span class="co">#&gt; [28] cachem_1.1.0        yaml_2.3.12         cvar_0.6           </span></span>
<span><span class="co">#&gt; [31] tools_4.5.2         dplyr_1.2.0         ggplot2_4.0.2      </span></span>
<span><span class="co">#&gt; [34] profmem_0.7.0       assertthat_0.2.1    vctrs_0.7.1        </span></span>
<span><span class="co">#&gt; [37] R6_2.6.1            lifecycle_1.0.5     fs_1.6.6           </span></span>
<span><span class="co">#&gt; [40] univariateML_1.5.0  ragg_1.5.0          pkgconfig_2.0.3    </span></span>
<span><span class="co">#&gt; [43] desc_1.4.3          gtable_0.3.6        pkgdown_2.2.0      </span></span>
<span><span class="co">#&gt; [46] pillar_1.11.1       bslib_0.10.0        glue_1.8.0         </span></span>
<span><span class="co">#&gt; [49] systemfonts_1.3.1   xfun_0.56           tibble_3.3.1       </span></span>
<span><span class="co">#&gt; [52] tidyselect_1.2.1    knitr_1.51          farver_2.1.2       </span></span>
<span><span class="co">#&gt; [55] spatial_7.3-18      htmltools_0.5.9     fBasics_4052.98    </span></span>
<span><span class="co">#&gt; [58] labeling_0.4.3      rmarkdown_2.30      timeDate_4052.112  </span></span>
<span><span class="co">#&gt; [61] compiler_4.5.2      S7_0.2.1</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan MacLean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
