<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Real-World Analysis Examples Implementation Plan (v3) • peppwR</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Real-World Analysis Examples Implementation Plan (v3)"><meta property="og:image" content="https://teammaclean.github.io/peppwR/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">peppwR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="articles/find-fits.html">Distribution Fitting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>In-depth Guides</h6></li>
    <li><a class="dropdown-item" href="articles/power-analysis-workflow.html">Power Analysis Workflow</a></li>
    <li><a class="dropdown-item" href="articles/benchmarking.html">Benchmarking</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Real-World Examples</h6></li>
    <li><a class="dropdown-item" href="articles/dda-time-course-power.html">DDA Time Course Analysis</a></li>
    <li><a class="dropdown-item" href="articles/prm-genotype-power.html">PRM Genotype Analysis</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/TeamMacLean/peppwR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.svg" class="logo" alt=""><h1>Real-World Analysis Examples Implementation Plan (v3)</h1>
      <small class="dont-index">Source: <a href="https://github.com/TeamMacLean/peppwR/blob/master/examples_plan.md" class="external-link"><code>examples_plan.md</code></a></small>
    </div>

<div id="real-world-analysis-examples-implementation-plan-v3" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>Create two static analysis documents demonstrating peppwR on real phosphoproteomics data. These are pre-rendered examples (not vignettes) stored in <code>inst/examples/</code> with committed HTML output.</p>
<p><strong>Key changes from v2:</strong> - Fixed incorrect assumptions about results - text must match rendered figures - Wilcoxon test has essentially zero power at N=3 with 2-fold effect - restructure to discover this early - Use Bayes factor test as primary test after comparison reveals Wilcoxon’s limitations - Distribution fitting shows Pareto/Skew Normal dominance (artifact of small sample size) - explain why - Remove/rework minimum detectable effect section (empty plots with Wilcoxon) - Improve PRM pedagogical tone to match DDA document</p>
<hr></div>
<div class="section level2">
<h2 id="critical-learnings-from-v2-rendering">Critical Learnings from v2 Rendering<a class="anchor" aria-label="anchor" href="#critical-learnings-from-v2-rendering"></a></h2>
<div class="section level3">
<h3 id="distribution-fitting-results">Distribution Fitting Results<a class="anchor" aria-label="anchor" href="#distribution-fitting-results"></a></h3>
<ul><li>
<strong>Observed</strong>: Pareto and Skew Normal are best fits, not lognormal/gamma</li>
<li>
<strong>Reason</strong>: With only N=3 per condition (6 observations per peptide), there’s insufficient data for reliable distribution selection. Gamma/lognormal would be expected with more data.</li>
<li>
<strong>Action</strong>: Explain this is an artifact of small sample size, not a statement about true underlying distributions</li>
</ul></div>
<div class="section level3">
<h3 id="wilcoxon-test-power">Wilcoxon Test Power<a class="anchor" aria-label="anchor" href="#wilcoxon-test-power"></a></h3>
<ul><li>
<strong>Observed</strong>: Essentially zero power at N=3 with 2-fold effect</li>
<li>
<strong>Reason</strong>: Non-parametric tests like Wilcoxon are conservative and need larger samples</li>
<li>
<strong>Action</strong>: Compare tests EARLY in the analysis to discover this, then switch to Bayes factor</li>
</ul></div>
<div class="section level3">
<h3 id="minimum-detectable-effect">Minimum Detectable Effect<a class="anchor" aria-label="anchor" href="#minimum-detectable-effect"></a></h3>
<ul><li>
<strong>Observed</strong>: Empty plots showing nothing detectable even at 0% power threshold</li>
<li>
<strong>Reason</strong>: Wilcoxon has no power, so MDE analysis is meaningless</li>
<li>
<strong>Action</strong>: Either remove this section or run it with Bayes factor test</li>
</ul></div>
<div class="section level3">
<h3 id="power-analysis-plots">Power Analysis Plots<a class="anchor" aria-label="anchor" href="#power-analysis-plots"></a></h3>
<ul><li>
<strong>Observed</strong>: Empty histograms showing no peptides achieve any power</li>
<li>
<strong>Action</strong>: After discovering Wilcoxon’s limitations, redo with Bayes factor to show meaningful results</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="data-summary">Data Summary<a class="anchor" aria-label="anchor" href="#data-summary"></a></h2>
<div class="section level3">
<h3 id="dda-data-sample_datadda_datacsv">DDA Data (<code>sample_data/dda_data.csv</code>)<a class="anchor" aria-label="anchor" href="#dda-data-sample_datadda_datacsv"></a></h3>
<ul><li>
<strong>Source</strong>: Arabidopsis phosphoproteomics</li>
<li>
<strong>Peptides</strong>: 2,228 unique phosphopeptides</li>
<li>
<strong>Comparison</strong>: Timepoint 0 vs 600 (earliest vs latest)</li>
<li>
<strong>Replicates</strong>: 3 biological replicates per timepoint (6 observations per peptide total)</li>
<li>
<strong>Missing</strong>: 0%</li>
<li>
<strong>Key columns</strong>: <code>new_annotation</code> (peptide ID), <code>genotype</code>, <code>bio_rep</code>, <code>timepoints</code>, <code>timepoints_values</code> (abundance)</li>
</ul></div>
<div class="section level3">
<h3 id="prm-data-sample_dataprm_datacsv">PRM Data (<code>sample_data/prm_data.csv</code>)<a class="anchor" aria-label="anchor" href="#prm-data-sample_dataprm_datacsv"></a></h3>
<ul><li>
<strong>Source</strong>: Fungal phosphoproteomics (rice blast)</li>
<li>
<strong>Peptides</strong>: 285 unique phosphopeptides</li>
<li>
<strong>Comparison</strong>: Timepoint 0 vs 6 (earliest vs latest)</li>
<li>
<strong>Replicates</strong>: 3 bio × 2 tech per condition</li>
<li>
<strong>Missing</strong>: 17% (good for missingness demo)</li>
<li>
<strong>Key columns</strong>: <code>peptide_modified_sequence</code> (peptide ID), <code>genotype</code>, <code>timepoint</code>, <code>bio_rep</code>, <code>tech_rep</code>, <code>total_area</code> (abundance)</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="document-1-dda-time-course-power-analysis">Document 1: DDA Time-Course Power Analysis<a class="anchor" aria-label="anchor" href="#document-1-dda-time-course-power-analysis"></a></h2>
<p><strong>File</strong>: <code>inst/examples/dda-time-course-power.Rmd</code></p>
<div class="section level3">
<h3 id="revised-outline">Revised Outline<a class="anchor" aria-label="anchor" href="#revised-outline"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu"># Power Analysis for Time-Course Phosphoproteomics (DDA)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ss">- </span>What is statistical power and why does it matter?</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ss">- </span>The challenge: phosphoproteomics experiments are expensive, sample sizes are small</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="ss">- </span>Goal: Determine what effects we can detect and plan future experiments</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="ss">- </span>Overview of the peppwR approach: fit distributions → simulate experiments → estimate power</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">## About the Data</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="ss">- </span>Arabidopsis phosphoproteomics time-course experiment</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="ss">- </span>DDA (Data-Dependent Acquisition) mass spectrometry</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="ss">- </span>Comparing early (t=0) vs late (t=600) timepoints</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="ss">- </span>3 biological replicates per condition (important limitation!)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="ss">- </span>2,228 phosphopeptides quantified</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="fu">## Data Preparation</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="ss">- </span>Load and filter data</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="ss">- </span>Reshape for peppwR (peptide_id, condition, abundance)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="ss">- </span>Quick EDA: abundance distribution across conditions</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fu">## Distribution Fitting</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="ss">- </span>Why fit distributions? (To simulate realistic experiments)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="ss">- </span>Run fit_distributions()</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="ss">- </span>**Interpret results honestly**: Pareto and Skew Normal dominate</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="ss">- </span>**Explain why**: With only 6 observations per peptide, distribution selection is unreliable</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="ss">- </span>This is an artifact of small sample size, not the "true" underlying distributions</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="ss">- </span>With more replicates, gamma/lognormal would likely fit better</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="ss">- </span>plot_param_distribution() with sample size context</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="fu">## Power Analysis</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="fu">### Choosing the Right Statistical Test</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>**IMPORTANT: Start with test comparison before doing other analyses**</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>With small samples (N=3), the choice of statistical test dramatically affects power:</span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="pp">|</span> Test <span class="pp">|</span> Type <span class="pp">|</span> Characteristics <span class="pp">|</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="pp">|------|------|-----------------|</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="pp">|</span> Wilcoxon rank-sum <span class="pp">|</span> Non-parametric <span class="pp">|</span> Conservative, needs larger N <span class="pp">|</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="pp">|</span> Bootstrap-t <span class="pp">|</span> Resampling <span class="pp">|</span> Handles non-normality <span class="pp">|</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="pp">|</span> Bayes factor <span class="pp">|</span> Bayesian <span class="pp">|</span> More powerful at small N <span class="pp">|</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>Compare all three tests at N=3 with 2-fold effect:</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a><span class="co"># Run all three tests</span></span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>power_wilcox <span class="ot">&lt;-</span> <span class="fu">power_analysis</span>(fits, <span class="at">effect_size =</span> <span class="dv">2</span>, <span class="at">n_per_group =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"wilcoxon"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>power_boot <span class="ot">&lt;-</span> <span class="fu">power_analysis</span>(fits, <span class="at">effect_size =</span> <span class="dv">2</span>, <span class="at">n_per_group =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"bootstrap_t"</span>)</span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>power_bayes <span class="ot">&lt;-</span> <span class="fu">power_analysis</span>(fits, <span class="at">effect_size =</span> <span class="dv">2</span>, <span class="at">n_per_group =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"bayes_t"</span>)</span></code></pre></div>
<p>Present results as a clear table:</p>
<table class="table"><colgroup><col width="21%"><col width="17%"><col width="30%"><col width="30%"></colgroup><thead><tr class="header"><th>Statistical Test</th>
<th>Median Power</th>
<th>% Peptides &gt; 50% Power</th>
<th>% Peptides &gt; 80% Power</th>
</tr></thead><tbody><tr class="odd"><td>Wilcoxon rank-sum</td>
<td>X.XX</td>
<td>X%</td>
<td>X%</td>
</tr><tr class="even"><td>Bootstrap-t</td>
<td>X.XX</td>
<td>X%</td>
<td>X%</td>
</tr><tr class="odd"><td>Bayes factor</td>
<td>X.XX</td>
<td>X%</td>
<td>X%</td>
</tr></tbody></table><p><strong>Key finding</strong>: Wilcoxon has essentially zero power at N=3. This is expected - non-parametric tests are conservative and need larger samples. The Bayes factor test provides usable power estimates.</p>
<p><strong>For remaining analyses, use Bayes factor test.</strong></p>
</div>
<div class="section level3">
<h3 id="the-three-questions-using-bayes-factor">The Three Questions (Using Bayes Factor)<a class="anchor" aria-label="anchor" href="#the-three-questions-using-bayes-factor"></a></h3>
<p>Power analysis can answer three related questions: 1. Given sample size and effect size → what is my power? 2. Given target power and effect size → what sample size do I need? 3. Given sample size and target power → what’s the minimum detectable effect?</p>
</div>
<div class="section level3">
<h3 id="question-1-current-power-n3-bayes-factor">Question 1: Current Power (N=3, Bayes Factor)<a class="anchor" aria-label="anchor" href="#question-1-current-power-n3-bayes-factor"></a></h3>
<ul><li>With 3 replicates, what power do we have to detect a 2-fold change?</li>
<li>Show actual distribution of power across peptides</li>
<li>Interpret: “X% of peptides achieve &gt;80% power”</li>
</ul></div>
<div class="section level3">
<h3 id="question-2-sample-size-for-target-power">Question 2: Sample Size for Target Power<a class="anchor" aria-label="anchor" href="#question-2-sample-size-for-target-power"></a></h3>
<ul><li>What N do we need for 80% power at 2-fold change? (use realistic effect)</li>
<li>Understanding the power curve</li>
<li>Show % peptides reaching target at each N</li>
</ul></div>
<div class="section level3">
<h3 id="question-3-minimum-detectable-effect">Question 3: Minimum Detectable Effect<a class="anchor" aria-label="anchor" href="#question-3-minimum-detectable-effect"></a></h3>
<p><strong>KNOWN ISSUE:</strong> <code>find = "effect_size"</code> is NOT YET IMPLEMENTED for per-peptide mode. See CLAUDE.md “Known Issues” section for details and fix plan.</p>
<p><strong>Current workaround options:</strong> 1. <strong>Remove this section</strong> from per-peptide examples until implemented 2. <strong>Use aggregate mode</strong> with representative parameters derived from fits: ```r # Derive representative lognormal params from fitted data # (most peptides are approximately lognormal on log scale) log_abundances &lt;- log(pilot<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false" form="prefix">[</mo><mi>p</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">abundance[pilot</annotation></semantics></math>abundance &gt; 0]) representative_params &lt;- list( meanlog = median(log_abundances), sdlog = sd(log_abundances) )</p>
<p># Run MDE in aggregate mode min_effect &lt;- power_analysis( distribution = “lnorm”, params = representative_params, n_per_group = 3, target_power = 0.8, find = “effect_size”, test = “bayes_t”, n_sim = 100 ) ``` 3. <strong>Wait for v2.2</strong> implementation of per-peptide MDE</p>
<p><strong>Recommendation:</strong> For now, remove Question 3 from per-peptide examples OR use aggregate mode with clear explanation that this represents a “typical” peptide, not the full peptidome distribution.</p>
</div>
</div>
<div class="section level2">
<h2 id="power-heatmap">Power Heatmap<a class="anchor" aria-label="anchor" href="#power-heatmap"></a></h2>
<div class="section level3">
<h3 id="why-aggregate-mode-for-heatmaps">Why Aggregate Mode for Heatmaps?<a class="anchor" aria-label="anchor" href="#why-aggregate-mode-for-heatmaps"></a></h3>
<p>The <code><a href="reference/plot_power_heatmap.html">plot_power_heatmap()</a></code> function uses <strong>aggregate mode</strong> (single distribution) rather than per-peptide mode because:</p>
<ol style="list-style-type: decimal"><li>
<strong>Computational cost</strong>: Per-peptide heatmaps would require <code>n_peptides × n_values × effect_values × n_sim</code> simulations (e.g., 2228 × 10 × 10 × 100 = 22M simulations)</li>
<li>
<strong>Visualization</strong>: A single heatmap is more interpretable than 2000+ individual heatmaps</li>
<li>
<strong>Purpose</strong>: Heatmaps answer “what’s the general tradeoff?” not “what’s the power for peptide X?”</li>
</ol></div>
<div class="section level3">
<h3 id="deriving-representative-parameters">Deriving Representative Parameters<a class="anchor" aria-label="anchor" href="#deriving-representative-parameters"></a></h3>
<p>To make the heatmap relevant to your data, derive parameters from the fitted distributions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1: Use median log-abundance parameters</span></span>
<span><span class="va">log_abundances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span><span class="op">[</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">log_abundances</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/mad.html" class="external-link">mad</a></span><span class="op">(</span><span class="va">log_abundances</span>, constant <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># robust SD estimate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: For gamma-like data, use moment matching</span></span>
<span><span class="va">abundances</span> <span class="op">&lt;-</span> <span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span><span class="op">[</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abundances</span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">abundances</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  shape <span class="op">=</span> <span class="va">m</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">v</span>,</span>
<span>  rate <span class="op">=</span> <span class="va">m</span> <span class="op">/</span> <span class="va">v</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="heatmap-code-with-explanation">Heatmap Code with Explanation<a class="anchor" aria-label="anchor" href="#heatmap-code-with-explanation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Derive representative parameters from the data</span></span>
<span><span class="va">log_abundances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span><span class="op">[</span><span class="va">pilot</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">derived_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">log_abundances</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/mad.html" class="external-link">mad</a></span><span class="op">(</span><span class="va">log_abundances</span>, constant <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Using representative lognormal parameters:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  meanlog ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">derived_params</span><span class="op">$</span><span class="va">meanlog</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  sdlog ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">derived_params</span><span class="op">$</span><span class="va">sdlog</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate heatmap</span></span>
<span><span class="fu"><a href="reference/plot_power_heatmap.html">plot_power_heatmap</a></span><span class="op">(</span></span>
<span>  distribution <span class="op">=</span> <span class="st">"lnorm"</span>,</span>
<span>  params <span class="op">=</span> <span class="va">derived_params</span>,</span>
<span>  n_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>  effect_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  test <span class="op">=</span> <span class="st">"wilcoxon"</span>  <span class="co"># heatmap uses aggregate mode</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpreting-the-heatmap">Interpreting the Heatmap<a class="anchor" aria-label="anchor" href="#interpreting-the-heatmap"></a></h3>
<p>The heatmap shows power for a <strong>representative peptide</strong> with typical abundance characteristics. Individual peptides will vary: - Low-variability peptides will have higher power than shown - High-variability peptides will have lower power than shown - Use the per-peptide <code>find = "power"</code> results to understand the distribution across peptides</p>
</div>
</div>
<div class="section level2">
<h2 id="summary-and-recommendations">Summary and Recommendations<a class="anchor" aria-label="anchor" href="#summary-and-recommendations"></a></h2>
<ul><li>Key findings:
<ul><li>Distribution fitting is unreliable at N=3 (Pareto/Skew Normal artifact)</li>
<li>Wilcoxon test has no power at N=3 - use Bayes factor instead</li>
<li>Actual power estimates with Bayes factor</li>
</ul></li>
<li>Practical recommendations:
<ul><li>Minimum sample size for reliable detection</li>
<li>Effect sizes that are detectable</li>
</ul></li>
<li>Caveats and limitations</li>
</ul></div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a></h2>
<pre><code>
### Key Code Changes

```r
# Test comparison - do this FIRST
power_wilcox &lt;- power_analysis(fits, effect_size = 2, n_per_group = 3,
                                find = "power", test = "wilcoxon", n_sim = 100)
power_boot &lt;- power_analysis(fits, effect_size = 2, n_per_group = 3,
                              find = "power", test = "bootstrap_t", n_sim = 100)
power_bayes &lt;- power_analysis(fits, effect_size = 2, n_per_group = 3,
                               find = "power", test = "bayes_t", n_sim = 100)

# Create comparison table
comparison &lt;- tibble::tibble(
  Test = c("Wilcoxon rank-sum", "Bootstrap-t", "Bayes factor"),
  `Median Power` = c(
    median(power_wilcox$simulations$peptide_power, na.rm = TRUE),
    median(power_boot$simulations$peptide_power, na.rm = TRUE),
    median(power_bayes$simulations$peptide_power, na.rm = TRUE)
  ),
  `% &gt; 50% Power` = c(
    mean(power_wilcox$simulations$peptide_power &gt; 0.5, na.rm = TRUE) * 100,
    mean(power_boot$simulations$peptide_power &gt; 0.5, na.rm = TRUE) * 100,
    mean(power_bayes$simulations$peptide_power &gt; 0.5, na.rm = TRUE) * 100
  ),
  `% &gt; 80% Power` = c(
    mean(power_wilcox$simulations$peptide_power &gt; 0.8, na.rm = TRUE) * 100,
    mean(power_boot$simulations$peptide_power &gt; 0.8, na.rm = TRUE) * 100,
    mean(power_bayes$simulations$peptide_power &gt; 0.8, na.rm = TRUE) * 100
  )
)
knitr::kable(comparison, digits = 2)

# Subsequent analyses use Bayes factor
power_n3 &lt;- power_analysis(fits, effect_size = 2, n_per_group = 3,
                           find = "power", test = "bayes_t", n_sim = 100)

sample_size &lt;- power_analysis(fits, effect_size = 2, target_power = 0.8,
                              find = "sample_size", test = "bayes_t", n_sim = 100)

# Power heatmap - derive representative parameters from data
log_abundances &lt;- log(pilot$abundance[pilot$abundance &gt; 0])
derived_params &lt;- list(
  meanlog = median(log_abundances),
  sdlog = mad(log_abundances, constant = 1)
)

plot_power_heatmap(
  distribution = "lnorm",
  params = derived_params,
  n_range = c(3, 12),
  effect_range = c(1.5, 4),
  test = "wilcoxon"  # heatmap uses aggregate mode
)</code></pre>
<hr></div>
<div class="section level2">
<h2 id="document-2-prm-analysis-with-missing-data">Document 2: PRM Analysis with Missing Data<a class="anchor" aria-label="anchor" href="#document-2-prm-analysis-with-missing-data"></a></h2>
<p><strong>File</strong>: <code>inst/examples/prm-genotype-power.Rmd</code></p>
<div class="section level3">
<h3 id="revised-outline-improved-pedagogy">Revised Outline (Improved Pedagogy)<a class="anchor" aria-label="anchor" href="#revised-outline-improved-pedagogy"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu"># Power Analysis for Targeted Proteomics with Missing Data (PRM)</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">### What Makes Targeted Proteomics Different?</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>Mass spectrometry-based proteomics operates in two fundamentally different modes:</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>**Discovery proteomics (DDA)** casts a wide net:</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="ss">- </span>Measures thousands of proteins/peptides</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="ss">- </span>Identifies whatever is abundant enough to detect</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="ss">- </span>Great for hypothesis generation</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="ss">- </span>High multiple testing burden</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>**Targeted proteomics (PRM/SRM)** takes aim at specific targets:</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="ss">- </span>Measures a pre-defined panel of peptides</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="ss">- </span>Higher sensitivity and reproducibility</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="ss">- </span>Better for hypothesis testing</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="ss">- </span>Lower multiple testing burden</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>This document analyzes a PRM dataset, demonstrating how peppwR handles the unique challenges of targeted proteomics.</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="fu">### The Missing Data Challenge</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>Even with targeted methods, missing values are ubiquitous in mass spectrometry. But not all missing data is created equal:</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>**MCAR (Missing Completely At Random)**</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="ss">- </span>Values missing due to random technical failures</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="ss">- </span>No relationship to abundance</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="ss">- </span>Reduces sample size but doesn't bias results</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>**MNAR (Missing Not At Random)**</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="ss">- </span>Low-abundance peptides systematically missing</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="ss">- </span>Below detection limit = no measurement</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="ss">- </span>Can bias abundance estimates upward</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="ss">- </span>Common in mass spectrometry</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>peppwR tracks both the rate of missingness AND evidence for MNAR patterns, enabling more realistic power estimates.</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="fu">### Goals of This Analysis</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a><span class="ss">1. </span>Characterize missingness patterns in the data</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a><span class="ss">2. </span>Identify peptides with MNAR evidence</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="ss">3. </span>Compare power with/without accounting for missingness</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="ss">4. </span>Determine realistic sample size requirements</span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a><span class="ss">5. </span>Understand FDR impact on power</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a><span class="fu">## About the Data</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>This analysis uses fungal phosphoproteomics data from a targeted PRM experiment:</span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a><span class="pp">|</span> Property <span class="pp">|</span> Value <span class="pp">|</span></span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a><span class="pp">|----------|-------|</span></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a><span class="pp">|</span> Organism <span class="pp">|</span> *Magnaporthe oryzae* (rice blast fungus) <span class="pp">|</span></span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a><span class="pp">|</span> Method <span class="pp">|</span> PRM (Parallel Reaction Monitoring) <span class="pp">|</span></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a><span class="pp">|</span> Comparison <span class="pp">|</span> Early (t=0) vs late (t=6) timepoints <span class="pp">|</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a><span class="pp">|</span> Biological replicates <span class="pp">|</span> 3 per condition <span class="pp">|</span></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a><span class="pp">|</span> Technical replicates <span class="pp">|</span> 2 per biological replicate <span class="pp">|</span></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a><span class="pp">|</span> Peptides <span class="pp">|</span> 285 phosphopeptides <span class="pp">|</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a><span class="pp">|</span> Missing data <span class="pp">|</span> ~17% <span class="pp">|</span></span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" tabindex="-1"></a><span class="fu">## Data Preparation</span></span>
<span id="cb5-63"><a href="#cb5-63" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" tabindex="-1"></a><span class="co">[</span><span class="ot">Same as before but with better explanatory text</span><span class="co">]</span></span>
<span id="cb5-65"><a href="#cb5-65" tabindex="-1"></a></span>
<span id="cb5-66"><a href="#cb5-66" tabindex="-1"></a><span class="fu">### Why Average Technical Replicates?</span></span>
<span id="cb5-67"><a href="#cb5-67" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" tabindex="-1"></a>Technical replicates measure the same biological sample multiple times. They capture *measurement* variability, not *biological* variability.</span>
<span id="cb5-69"><a href="#cb5-69" tabindex="-1"></a></span>
<span id="cb5-70"><a href="#cb5-70" tabindex="-1"></a>For power analysis, biological replicates are the true unit of replication - they represent independent observations of the biological phenomenon we're studying. We average technical replicates to get one value per biological replicate.</span>
<span id="cb5-71"><a href="#cb5-71" tabindex="-1"></a></span>
<span id="cb5-72"><a href="#cb5-72" tabindex="-1"></a><span class="fu">## Missingness Analysis</span></span>
<span id="cb5-73"><a href="#cb5-73" tabindex="-1"></a></span>
<span id="cb5-74"><a href="#cb5-74" tabindex="-1"></a><span class="fu">### Examining the Extent of Missingness</span></span>
<span id="cb5-75"><a href="#cb5-75" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" tabindex="-1"></a>Before diving into power analysis, we need to understand our missing data:</span>
<span id="cb5-77"><a href="#cb5-77" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb5-79"><a href="#cb5-79" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">fit_distributions</span>(pilot, <span class="st">"peptide_id"</span>, <span class="st">"condition"</span>, <span class="st">"abundance"</span>)</span>
<span id="cb5-80"><a href="#cb5-80" tabindex="-1"></a><span class="fu">print</span>(fits)  <span class="co"># Shows missingness summary</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-missingness-patterns">Visualizing Missingness Patterns<a class="anchor" aria-label="anchor" href="#visualizing-missingness-patterns"></a></h3>
<p>The <code><a href="reference/plot_missingness.html">plot_missingness()</a></code> function provides three complementary views:</p>
<ol style="list-style-type: decimal"><li>
<strong>NA Rate Distribution</strong>: What fraction of observations are missing for each peptide?</li>
<li>
<strong>MNAR Score Distribution</strong>: Is there evidence that missingness correlates with abundance?</li>
<li>
<strong>Abundance vs NA Rate</strong>: Do low-abundance peptides have more missing values?</li>
</ol><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_missingness.html">plot_missingness</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpreting-mnar-scores">Interpreting MNAR Scores<a class="anchor" aria-label="anchor" href="#interpreting-mnar-scores"></a></h3>
<p>The MNAR score is a z-statistic testing whether missing observations have systematically different (lower) abundance than observed values.</p>
<table class="table"><thead><tr class="header"><th>MNAR Score</th>
<th>Interpretation</th>
</tr></thead><tbody><tr class="odd"><td>&lt; 1</td>
<td>Little evidence for MNAR</td>
</tr><tr class="even"><td>1-2</td>
<td>Weak evidence</td>
</tr><tr class="odd"><td>2-3</td>
<td>Moderate evidence</td>
</tr><tr class="even"><td>&gt; 3</td>
<td>Strong evidence for MNAR</td>
</tr></tbody></table><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mnar_peptides</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_mnar_peptides.html">get_mnar_peptides</a></span><span class="op">(</span><span class="va">fits</span>, threshold <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-to-do-with-mnar-peptides">What to Do with MNAR Peptides<a class="anchor" aria-label="anchor" href="#what-to-do-with-mnar-peptides"></a></h3>
<p>Peptides with high MNAR scores require careful handling: - Their abundance estimates may be biased upward - Power calculations may be optimistic - Consider robust statistical methods - Report separately in publications</p>
</div>
</div>
<div class="section level2">
<h2 id="distribution-fitting">Distribution Fitting<a class="anchor" aria-label="anchor" href="#distribution-fitting"></a></h2>
<div class="section level3">
<h3 id="why-fit-distributions">Why Fit Distributions?<a class="anchor" aria-label="anchor" href="#why-fit-distributions"></a></h3>
<p>[Same pedagogical content as DDA document]</p>
</div>
<div class="section level3">
<h3 id="results-a-cautionary-note-on-small-samples">Results: A Cautionary Note on Small Samples<a class="anchor" aria-label="anchor" href="#results-a-cautionary-note-on-small-samples"></a></h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></code></pre></div>
<p><strong>Important</strong>: Like the DDA dataset, we see Pareto and Skew Normal as dominant best-fit distributions. This is an <strong>artifact of small sample size</strong> (only 6 observations per peptide when averaged across tech reps), not a statement about true underlying distributions.</p>
<p>With more biological replicates, we would expect gamma and lognormal distributions to fit better - these are the typical distributions for mass spectrometry abundance data.</p>
</div>
</div>
<div class="section level2">
<h2 id="power-analysis">Power Analysis<a class="anchor" aria-label="anchor" href="#power-analysis"></a></h2>
<div class="section level3">
<h3 id="choosing-the-right-statistical-test">Choosing the Right Statistical Test<a class="anchor" aria-label="anchor" href="#choosing-the-right-statistical-test"></a></h3>
<p><strong>Critical first step</strong>: Compare statistical tests before committing to one.</p>
<p>With small samples (N=3), test choice dramatically affects power:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_wilcox</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                test <span class="op">=</span> <span class="st">"wilcoxon"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">power_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                              test <span class="op">=</span> <span class="st">"bootstrap_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">power_bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="fl">2</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                               test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>[Present as table like DDA document]</p>
<p><strong>Key finding</strong>: [Describe actual results - likely Wilcoxon has no power, Bayes factor is best]</p>
<p><strong>For remaining analyses, use Bayes factor test.</strong></p>
</div>
<div class="section level3">
<h3 id="what-effect-size-can-we-detect">What Effect Size Can We Detect?<a class="anchor" aria-label="anchor" href="#what-effect-size-can-we-detect"></a></h3>
<p>Before asking “what’s my power at 2-fold?”, ask “what effect size IS detectable?”</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, understand what's detectable</span></span>
<span><span class="va">min_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>, target_power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                             find <span class="op">=</span> <span class="st">"effect_size"</span>, test <span class="op">=</span> <span class="st">"bayes_t"</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>This informs whether a 2-fold threshold is realistic or if we need to consider larger effects.</p>
</div>
<div class="section level3">
<h3 id="power-at-realistic-effect-sizes">Power at Realistic Effect Sizes<a class="anchor" aria-label="anchor" href="#power-at-realistic-effect-sizes"></a></h3>
<p>[Use effect size informed by min_effect analysis]</p>
</div>
<div class="section level3">
<h3 id="impact-of-missingness-on-power">Impact of Missingness on Power<a class="anchor" aria-label="anchor" href="#impact-of-missingness-on-power"></a></h3>
<p>Compare power estimates with and without accounting for missingness:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_no_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="va">X</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"bayes_t"</span>, include_missingness <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">power_with_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="va">X</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                   test <span class="op">=</span> <span class="st">"bayes_t"</span>, include_missingness <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Missingness reduces effective sample size. The difference between these estimates shows the “cost” of missing data.</p>
</div>
<div class="section level3">
<h3 id="fdr-aware-power">FDR-Aware Power<a class="anchor" aria-label="anchor" href="#fdr-aware-power"></a></h3>
<p>With 285 peptides, multiple testing correction matters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_fdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/power_analysis.html">power_analysis</a></span><span class="op">(</span><span class="va">fits</span>, effect_size <span class="op">=</span> <span class="va">X</span>, n_per_group <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                            test <span class="op">=</span> <span class="st">"bayes_t"</span>, apply_fdr <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            prop_null <span class="op">=</span> <span class="fl">0.8</span>, n_sim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><strong>Understanding <code>prop_null</code></strong>: This parameter specifies the assumed proportion of true null hypotheses. With <code>prop_null = 0.8</code>, we assume 80% of peptides have no true effect. This affects how stringent the FDR correction is.</p>
</div>
</div>
<div class="section level2">
<h2 id="summary-and-recommendations-1">Summary and Recommendations<a class="anchor" aria-label="anchor" href="#summary-and-recommendations-1"></a></h2>
<div class="section level3">
<h3 id="key-findings">Key Findings<a class="anchor" aria-label="anchor" href="#key-findings"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Missingness</strong>: ~17% missing with [X] peptides showing MNAR evidence</li>
<li>
<strong>Test selection</strong>: Wilcoxon has no power at N=3; Bayes factor is usable</li>
<li>
<strong>Distribution fitting</strong>: Pareto/Skew Normal dominance is artifact of small N</li>
<li>
<strong>Power estimates</strong>: [Actual results]</li>
<li>
<strong>FDR impact</strong>: [Actual results]</li>
</ol></div>
<div class="section level3">
<h3 id="practical-recommendations">Practical Recommendations<a class="anchor" aria-label="anchor" href="#practical-recommendations"></a></h3>
<p>[Based on actual results]</p>
</div>
<div class="section level3">
<h3 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a></h3>
<ul><li>Small sample size limits distribution fitting reliability</li>
<li>MNAR models are approximations</li>
<li>prop_null requires assumptions about true effect rates</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="session-info-1">Session Info<a class="anchor" aria-label="anchor" href="#session-info-1"></a></h2>
<p>```</p>
<hr></div>
<div class="section level2">
<h2 id="implementation-steps">Implementation Steps<a class="anchor" aria-label="anchor" href="#implementation-steps"></a></h2>
<ol style="list-style-type: decimal"><li>
<p>Update DDA Rmd following revised outline</p>
<ul><li>Move test comparison to EARLY in analysis</li>
<li>Fix distribution fitting interpretation</li>
<li>Use Bayes factor for main analyses</li>
<li>Create proper comparison table</li>
<li>Remove/fix minimum detectable effect section</li>
</ul></li>
<li>
<p>Render and <strong>carefully verify</strong> DDA HTML</p>
<ul><li>Check each figure matches its accompanying text</li>
<li>Verify table values are populated correctly</li>
</ul></li>
<li>
<p>Update PRM Rmd following revised outline</p>
<ul><li>Improve pedagogical tone throughout</li>
<li>Same test comparison approach as DDA</li>
<li>Better MNAR explanation</li>
<li>Use effect size informed by data, not assumed 2-fold</li>
</ul></li>
<li>
<p>Render and <strong>carefully verify</strong> PRM HTML</p>
<ul><li>Same verification as DDA</li>
</ul></li>
<li><p>Run devtools::check(vignettes = FALSE)</p></li>
<li><p>Commit changes</p></li>
</ol><hr></div>
<div class="section level2">
<h2 id="writing-guidelines">Writing Guidelines<a class="anchor" aria-label="anchor" href="#writing-guidelines"></a></h2>
<div class="section level3">
<h3 id="text-must-match-figures">Text Must Match Figures<a class="anchor" aria-label="anchor" href="#text-must-match-figures"></a></h3>
<p><strong>NEVER</strong> write explanatory text that assumes a result. Instead: - Run the analysis first - Look at the actual output/figure - Write text that accurately describes what you see</p>
<p>Bad: “The results show lognormal distributions dominate…” Good: “The results show [describe actual bars in figure]…”</p>
</div>
<div class="section level3">
<h3 id="explain-unexpected-results">Explain Unexpected Results<a class="anchor" aria-label="anchor" href="#explain-unexpected-results"></a></h3>
<p>When results don’t match intuition, explain why: - Pareto/Skew Normal dominance → small sample size artifact - Zero Wilcoxon power → non-parametric tests need larger N - Empty MDE plots → using wrong test for the data</p>
</div>
<div class="section level3">
<h3 id="use-tables-for-comparisons">Use Tables for Comparisons<a class="anchor" aria-label="anchor" href="#use-tables-for-comparisons"></a></h3>
<p>When comparing multiple options (tests, conditions), use a clear table:</p>
<table class="table"><thead><tr class="header"><th>Option A</th>
<th>Option B</th>
<th>Option C</th>
</tr></thead><tbody><tr class="odd"><td>value</td>
<td>value</td>
<td>value</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="pedagogical-consistency">Pedagogical Consistency<a class="anchor" aria-label="anchor" href="#pedagogical-consistency"></a></h3>
<p>Both documents should have similar tone and structure: - Explain “why” before “how” - Use consistent terminology - Similar section headers where appropriate</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="verification-checklist">Verification Checklist<a class="anchor" aria-label="anchor" href="#verification-checklist"></a></h2>
<p>After implementation: - [ ] DDA Rmd renders without error - [ ] DDA figures match their explanatory text - [ ] Test comparison table shows actual computed values - [ ] Bayes factor used for main analyses (not Wilcoxon) - [ ] Distribution fitting text explains Pareto/Skew Normal artifact - [ ] PRM Rmd renders without error - [ ] PRM figures match their explanatory text - [ ] PRM has same pedagogical quality as DDA - [ ] Effect size threshold informed by data (not assumed) - [ ] devtools::check(vignettes = FALSE) passes with 0 errors, 0 warnings - [ ] Changes committed</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan MacLean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

